import{N as _i,a as ut,b as Ds,c as Ls,d as hi,e as fi,f as pi,g as Ms,h as xs,i as Fs,j as Qt,l as ce,m as Xt,n as Us,o as Zt,r as He,s as en,t as he,u as Ws,w as fe}from"./chunk-OVW572WK.js";import{a as ui,b as di,e as _}from"./chunk-JHI3MBHO.js";var Vs=()=>{};var gi={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"};var p=function(n,e){if(!n)throw Ee(e)},Ee=function(n){return new Error("Firebase Database ("+gi.SDK_VERSION+") INTERNAL ASSERT FAILED: "+n)};var $s=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):(r&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(r=65536+((r&1023)<<10)+(n.charCodeAt(++i)&1023),e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},Xc=function(n){let e=[],t=0,i=0;for(;t<n.length;){let r=n[t++];if(r<128)e[i++]=String.fromCharCode(r);else if(r>191&&r<224){let s=n[t++];e[i++]=String.fromCharCode((r&31)<<6|s&63)}else if(r>239&&r<365){let s=n[t++],o=n[t++],a=n[t++],c=((r&7)<<18|(s&63)<<12|(o&63)<<6|a&63)-65536;e[i++]=String.fromCharCode(55296+(c>>10)),e[i++]=String.fromCharCode(56320+(c&1023))}else{let s=n[t++],o=n[t++];e[i++]=String.fromCharCode((r&15)<<12|(s&63)<<6|o&63)}}return e.join("")},ze={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,e){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();let t=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let r=0;r<n.length;r+=3){let s=n[r],o=r+1<n.length,a=o?n[r+1]:0,c=r+2<n.length,l=c?n[r+2]:0,h=s>>2,d=(s&3)<<4|a>>4,u=(a&15)<<2|l>>6,f=l&63;c||(f=64,o||(u=64)),i.push(t[h],t[d],t[u],t[f])}return i.join("")},encodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(n):this.encodeByteArray($s(n),e)},decodeString(n,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(n):Xc(this.decodeStringToByteArray(n,e))},decodeStringToByteArray(n,e){this.init_();let t=e?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let r=0;r<n.length;){let s=t[n.charAt(r++)],a=r<n.length?t[n.charAt(r)]:0;++r;let l=r<n.length?t[n.charAt(r)]:64;++r;let d=r<n.length?t[n.charAt(r)]:64;if(++r,s==null||a==null||l==null||d==null)throw new vi;let u=s<<2|a>>4;if(i.push(u),l!==64){let f=a<<4&240|l>>2;if(i.push(f),d!==64){let m=l<<6&192|d;i.push(m)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}},vi=class extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}},Ii=function(n){let e=$s(n);return ze.encodeByteArray(e,!0)},ht=function(n){return Ii(n).replace(/\./g,"")},$e=function(n){try{return ze.decodeString(n,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function js(n){return zs(void 0,n)}function zs(n,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:let t=e;return new Date(t.getTime());case Object:n===void 0&&(n={});break;case Array:n=[];break;default:return e}for(let t in e)!e.hasOwnProperty(t)||!Zc(t)||(n[t]=zs(n[t],e[t]));return n}function Zc(n){return n!=="__proto__"}function qs(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}var el=()=>qs().__FIREBASE_DEFAULTS__,tl=()=>{if(typeof process>"u"||typeof process.env>"u")return;let n=process.env.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},nl=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}let e=n&&$e(n[1]);return e&&JSON.parse(e)},Ei=()=>{try{return Vs()||el()||tl()||nl()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Gs=n=>{var e,t;return(t=(e=Ei())===null||e===void 0?void 0:e.emulatorHosts)===null||t===void 0?void 0:t[n]},Ks=n=>{let e=Gs(n);if(!e)return;let t=e.lastIndexOf(":");if(t<=0||t+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);let i=parseInt(e.substring(t+1),10);return e[0]==="["?[e.substring(1,t-1),i]:[e.substring(0,t),i]},wi=()=>{var n;return(n=Ei())===null||n===void 0?void 0:n.config},Ys=n=>{var e;return(e=Ei())===null||e===void 0?void 0:e[`_${n}`]};var z=class{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,i)=>{t?this.reject(t):this.resolve(i),typeof e=="function"&&(this.promise.catch(()=>{}),e.length===1?e(t):e(t,i))}}};function we(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}function Ti(n){return _(this,null,function*(){return(yield fetch(n,{credentials:"include"})).ok})}function Js(n,e){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');let t={alg:"none",type:"JWT"},i=e||"demo-project",r=n.iat||0,s=n.sub||n.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");let o=Object.assign({iss:`https://securetoken.google.com/${i}`,aud:i,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},n);return[ht(JSON.stringify(t)),ht(JSON.stringify(o)),""].join(".")}var dt={};function il(){let n={prod:[],emulator:[]};for(let e of Object.keys(dt))dt[e]?n.emulator.push(e):n.prod.push(e);return n}function rl(n){let e=document.getElementById(n),t=!1;return e||(e=document.createElement("div"),e.setAttribute("id",n),t=!0),{created:t,element:e}}var Bs=!1;function Ci(n,e){if(typeof window>"u"||typeof document>"u"||!we(window.location.host)||dt[n]===e||dt[n]||Bs)return;dt[n]=e;function t(u){return`__firebase__banner__${u}`}let i="__firebase__banner",s=il().prod.length>0;function o(){let u=document.getElementById(i);u&&u.remove()}function a(u){u.style.display="flex",u.style.background="#7faaf0",u.style.position="fixed",u.style.bottom="5px",u.style.left="5px",u.style.padding=".5em",u.style.borderRadius="5px",u.style.alignItems="center"}function c(u,f){u.setAttribute("width","24"),u.setAttribute("id",f),u.setAttribute("height","24"),u.setAttribute("viewBox","0 0 24 24"),u.setAttribute("fill","none"),u.style.marginLeft="-6px"}function l(){let u=document.createElement("span");return u.style.cursor="pointer",u.style.marginLeft="16px",u.style.fontSize="24px",u.innerHTML=" &times;",u.onclick=()=>{Bs=!0,o()},u}function h(u,f){u.setAttribute("id",f),u.innerText="Learn more",u.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",u.setAttribute("target","__blank"),u.style.paddingLeft="5px",u.style.textDecoration="underline"}function d(){let u=rl(i),f=t("text"),m=document.getElementById(f)||document.createElement("span"),E=t("learnmore"),A=document.getElementById(E)||document.createElement("a"),V=t("preprendIcon"),B=document.getElementById(V)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(u.created){let j=u.element;a(j),h(A,E);let Be=l();c(B,V),j.append(B,m,A,Be),document.body.appendChild(j)}s?(m.innerText="Preview backend disconnected.",B.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(B.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,m.innerText="Preview backend running in this workspace."),m.setAttribute("id",f)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function G(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function ft(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(G())}function Qs(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Xs(){let n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function nn(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ee(){return gi.NODE_CLIENT===!0||gi.NODE_ADMIN===!0}function rn(){try{return typeof indexedDB=="object"}catch{return!1}}function Zs(){return new Promise((n,e)=>{try{let t=!0,i="validate-browser-context-for-indexeddb-analytics-module",r=self.indexedDB.open(i);r.onsuccess=()=>{r.result.close(),t||self.indexedDB.deleteDatabase(i),n(!0)},r.onupgradeneeded=()=>{t=!1},r.onerror=()=>{var s;e(((s=r.error)===null||s===void 0?void 0:s.message)||"")}}catch(t){e(t)}})}var sl="FirebaseError",Z=class n extends Error{constructor(e,t,i){super(t),this.code=e,this.customData=i,this.name=sl,Object.setPrototypeOf(this,n.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,q.prototype.create)}},q=class{constructor(e,t,i){this.service=e,this.serviceName=t,this.errors=i}create(e,...t){let i=t[0]||{},r=`${this.service}/${e}`,s=this.errors[e],o=s?ol(s,i):"Error",a=`${this.serviceName}: ${o} (${r}).`;return new Z(r,a,i)}};function ol(n,e){return n.replace(al,(t,i)=>{let r=e[i];return r!=null?String(r):`<${i}?>`})}var al=/\{\$([^}]+)}/g;function je(n){return JSON.parse(n)}function P(n){return JSON.stringify(n)}var eo=function(n){let e={},t={},i={},r="";try{let s=n.split(".");e=je($e(s[0])||""),t=je($e(s[1])||""),r=s[2],i=t.d||{},delete t.d}catch{}return{header:e,claims:t,data:i,signature:r}};var to=function(n){let e=eo(n),t=e.claims;return!!t&&typeof t=="object"&&t.hasOwnProperty("iat")},no=function(n){let e=eo(n).claims;return typeof e=="object"&&e.admin===!0};function te(n,e){return Object.prototype.hasOwnProperty.call(n,e)}function Te(n,e){if(Object.prototype.hasOwnProperty.call(n,e))return n[e]}function sn(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}function pt(n,e,t){let i={};for(let r in n)Object.prototype.hasOwnProperty.call(n,r)&&(i[r]=e.call(t,n[r],r,n));return i}function Ce(n,e){if(n===e)return!0;let t=Object.keys(n),i=Object.keys(e);for(let r of t){if(!i.includes(r))return!1;let s=n[r],o=e[r];if(Hs(s)&&Hs(o)){if(!Ce(s,o))return!1}else if(s!==o)return!1}for(let r of i)if(!t.includes(r))return!1;return!0}function Hs(n){return n!==null&&typeof n=="object"}function _t(n){let e=[];for(let[t,i]of Object.entries(n))Array.isArray(i)?i.forEach(r=>{e.push(encodeURIComponent(t)+"="+encodeURIComponent(r))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(i));return e.length?"&"+e.join("&"):""}var tn=class{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=512/8,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);let i=this.W_;if(typeof e=="string")for(let d=0;d<16;d++)i[d]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let d=0;d<16;d++)i[d]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let d=16;d<80;d++){let u=i[d-3]^i[d-8]^i[d-14]^i[d-16];i[d]=(u<<1|u>>>31)&4294967295}let r=this.chain_[0],s=this.chain_[1],o=this.chain_[2],a=this.chain_[3],c=this.chain_[4],l,h;for(let d=0;d<80;d++){d<40?d<20?(l=a^s&(o^a),h=1518500249):(l=s^o^a,h=1859775393):d<60?(l=s&o|a&(s|o),h=2400959708):(l=s^o^a,h=3395469782);let u=(r<<5|r>>>27)+l+c+h+i[d]&4294967295;c=a,a=o,o=(s<<30|s>>>2)&4294967295,s=r,r=u}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+s&4294967295,this.chain_[2]=this.chain_[2]+o&4294967295,this.chain_[3]=this.chain_[3]+a&4294967295,this.chain_[4]=this.chain_[4]+c&4294967295}update(e,t){if(e==null)return;t===void 0&&(t=e.length);let i=t-this.blockSize,r=0,s=this.buf_,o=this.inbuf_;for(;r<t;){if(o===0)for(;r<=i;)this.compress_(e,r),r+=this.blockSize;if(typeof e=="string"){for(;r<t;)if(s[o]=e.charCodeAt(r),++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}else for(;r<t;)if(s[o]=e[r],++o,++r,o===this.blockSize){this.compress_(s),o=0;break}}this.inbuf_=o,this.total_+=t}digest(){let e=[],t=this.total_*8;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let r=this.blockSize-1;r>=56;r--)this.buf_[r]=t&255,t/=256;this.compress_(this.buf_);let i=0;for(let r=0;r<5;r++)for(let s=24;s>=0;s-=8)e[i]=this.chain_[r]>>s&255,++i;return e}};function io(n,e){let t=new yi(n,e);return t.subscribe.bind(t)}var yi=class{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(i=>{this.error(i)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,i){let r;if(e===void 0&&t===void 0&&i===void 0)throw new Error("Missing Observer.");cl(e,["next","error","complete"])?r=e:r={next:e,error:t,complete:i},r.next===void 0&&(r.next=mi),r.error===void 0&&(r.error=mi),r.complete===void 0&&(r.complete=mi);let s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?r.error(this.finalError):r.complete()}catch{}}),this.observers.push(r),s}unsubscribeOne(e){this.observers===void 0||this.observers[e]===void 0||(delete this.observers[e],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(this.observers!==void 0&&this.observers[e]!==void 0)try{t(this.observers[e])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(e){this.finalized||(this.finalized=!0,e!==void 0&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}};function cl(n,e){if(typeof n!="object"||n===null)return!1;for(let t of e)if(t in n&&typeof n[t]=="function")return!0;return!1}function mi(){}function on(n,e){return`${n} failed: ${e} argument `}var ro=function(n){let e=[],t=0;for(let i=0;i<n.length;i++){let r=n.charCodeAt(i);if(r>=55296&&r<=56319){let s=r-55296;i++,p(i<n.length,"Surrogate pair missing trail surrogate.");let o=n.charCodeAt(i)-56320;r=65536+(s<<10)+o}r<128?e[t++]=r:r<2048?(e[t++]=r>>6|192,e[t++]=r&63|128):r<65536?(e[t++]=r>>12|224,e[t++]=r>>6&63|128,e[t++]=r&63|128):(e[t++]=r>>18|240,e[t++]=r>>12&63|128,e[t++]=r>>6&63|128,e[t++]=r&63|128)}return e},mt=function(n){let e=0;for(let t=0;t<n.length;t++){let i=n.charCodeAt(t);i<128?e++:i<2048?e+=2:i>=55296&&i<=56319?(e+=4,t++):e+=3}return e};var o_=14400*1e3;function x(n){return n&&n._delegate?n._delegate:n}var L=class{constructor(e,t,i){this.name=e,this.instanceFactory=t,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}};var be="[DEFAULT]";var an=class{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let i=new z;if(this.instancesDeferred.set(t,i),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&i.resolve(r)}catch{}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let i=this.normalizeInstanceIdentifier(e?.identifier),r=(t=e?.optional)!==null&&t!==void 0?t:!1;if(this.isInitialized(i)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:i})}catch(s){if(r)return null;throw s}else{if(r)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,!!this.shouldAutoInitialize()){if(ul(e))try{this.getOrInitializeService({instanceIdentifier:be})}catch{}for(let[t,i]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(t);try{let s=this.getOrInitializeService({instanceIdentifier:r});i.resolve(s)}catch{}}}}clearInstance(e=be){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}delete(){return _(this,null,function*(){let e=Array.from(this.instances.values());yield Promise.all([...e.filter(t=>"INTERNAL"in t).map(t=>t.INTERNAL.delete()),...e.filter(t=>"_delete"in t).map(t=>t._delete())])})}isComponentSet(){return this.component!=null}isInitialized(e=be){return this.instances.has(e)}getOptions(e=be){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,i=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let r=this.getOrInitializeService({instanceIdentifier:i,options:t});for(let[s,o]of this.instancesDeferred.entries()){let a=this.normalizeInstanceIdentifier(s);i===a&&o.resolve(r)}return r}onInit(e,t){var i;let r=this.normalizeInstanceIdentifier(t),s=(i=this.onInitCallbacks.get(r))!==null&&i!==void 0?i:new Set;s.add(e),this.onInitCallbacks.set(r,s);let o=this.instances.get(r);return o&&e(o,r),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){let i=this.onInitCallbacks.get(t);if(i)for(let r of i)try{r(e,t)}catch{}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let i=this.instances.get(e);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:ll(e),options:t}),this.instances.set(e,i),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(i,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,i)}catch{}return i||null}normalizeInstanceIdentifier(e=be){return this.component?this.component.multipleInstances?e:be:e}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}};function ll(n){return n===be?void 0:n}function ul(n){return n.instantiationMode==="EAGER"}var gt=class{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new an(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}};var dl=[],C=(function(n){return n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT",n})(C||{}),hl={debug:C.DEBUG,verbose:C.VERBOSE,info:C.INFO,warn:C.WARN,error:C.ERROR,silent:C.SILENT},fl=C.INFO,pl={[C.DEBUG]:"log",[C.VERBOSE]:"log",[C.INFO]:"info",[C.WARN]:"warn",[C.ERROR]:"error"},_l=(n,e,...t)=>{if(e<n.logLevel)return;let i=new Date().toISOString(),r=pl[e];if(r)console[r](`[${i}]  ${n.name}:`,...t);else throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`)},ne=class{constructor(e){this.name=e,this._logLevel=fl,this._logHandler=_l,this._userLogHandler=null,dl.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in C))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel=typeof e=="string"?hl[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if(typeof e!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,C.DEBUG,...e),this._logHandler(this,C.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,C.VERBOSE,...e),this._logHandler(this,C.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,C.INFO,...e),this._logHandler(this,C.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,C.WARN,...e),this._logHandler(this,C.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,C.ERROR,...e),this._logHandler(this,C.ERROR,...e)}};var ml=(n,e)=>e.some(t=>n instanceof t),so,oo;function gl(){return so||(so=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function vl(){return oo||(oo=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}var ao=new WeakMap,Si=new WeakMap,co=new WeakMap,bi=new WeakMap,ki=new WeakMap;function yl(n){let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("success",s),n.removeEventListener("error",o)},s=()=>{t(ie(n.result)),r()},o=()=>{i(n.error),r()};n.addEventListener("success",s),n.addEventListener("error",o)});return e.then(t=>{t instanceof IDBCursor&&ao.set(t,n)}).catch(()=>{}),ki.set(e,n),e}function Il(n){if(Si.has(n))return;let e=new Promise((t,i)=>{let r=()=>{n.removeEventListener("complete",s),n.removeEventListener("error",o),n.removeEventListener("abort",o)},s=()=>{t(),r()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),r()};n.addEventListener("complete",s),n.addEventListener("error",o),n.addEventListener("abort",o)});Si.set(n,e)}var Ai={get(n,e,t){if(n instanceof IDBTransaction){if(e==="done")return Si.get(n);if(e==="objectStoreNames")return n.objectStoreNames||co.get(n);if(e==="store")return t.objectStoreNames[1]?void 0:t.objectStore(t.objectStoreNames[0])}return ie(n[e])},set(n,e,t){return n[e]=t,!0},has(n,e){return n instanceof IDBTransaction&&(e==="done"||e==="store")?!0:e in n}};function lo(n){Ai=n(Ai)}function El(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(e,...t){let i=n.call(cn(this),e,...t);return co.set(i,e.sort?e.sort():[e]),ie(i)}:vl().includes(n)?function(...e){return n.apply(cn(this),e),ie(ao.get(this))}:function(...e){return ie(n.apply(cn(this),e))}}function wl(n){return typeof n=="function"?El(n):(n instanceof IDBTransaction&&Il(n),ml(n,gl())?new Proxy(n,Ai):n)}function ie(n){if(n instanceof IDBRequest)return yl(n);if(bi.has(n))return bi.get(n);let e=wl(n);return e!==n&&(bi.set(n,e),ki.set(e,n)),e}var cn=n=>ki.get(n);function ho(n,e,{blocked:t,upgrade:i,blocking:r,terminated:s}={}){let o=indexedDB.open(n,e),a=ie(o);return i&&o.addEventListener("upgradeneeded",c=>{i(ie(o.result),c.oldVersion,c.newVersion,ie(o.transaction),c)}),t&&o.addEventListener("blocked",c=>t(c.oldVersion,c.newVersion,c)),a.then(c=>{s&&c.addEventListener("close",()=>s()),r&&c.addEventListener("versionchange",l=>r(l.oldVersion,l.newVersion,l))}).catch(()=>{}),a}var Tl=["get","getKey","getAll","getAllKeys","count"],Cl=["put","add","delete","clear"],Ri=new Map;function uo(n,e){if(!(n instanceof IDBDatabase&&!(e in n)&&typeof e=="string"))return;if(Ri.get(e))return Ri.get(e);let t=e.replace(/FromIndex$/,""),i=e!==t,r=Cl.includes(t);if(!(t in(i?IDBIndex:IDBObjectStore).prototype)||!(r||Tl.includes(t)))return;let s=function(o,...a){return _(this,null,function*(){let c=this.transaction(o,r?"readwrite":"readonly"),l=c.store;return i&&(l=l.index(a.shift())),(yield Promise.all([l[t](...a),r&&c.done]))[0]})};return Ri.set(e,s),s}lo(n=>di(ui({},n),{get:(e,t,i)=>uo(e,t)||n.get(e,t,i),has:(e,t)=>!!uo(e,t)||n.has(e,t)}));var Ni=class{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(t=>{if(bl(t)){let i=t.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(t=>t).join(" ")}};function bl(n){let e=n.getComponent();return e?.type==="VERSION"}var Oi="@firebase/app",fo="0.13.2";var le=new ne("@firebase/app"),Sl="@firebase/app-compat",Al="@firebase/analytics-compat",kl="@firebase/analytics",Rl="@firebase/app-check-compat",Pl="@firebase/app-check",Nl="@firebase/auth",Ol="@firebase/auth-compat",Dl="@firebase/database",Ll="@firebase/data-connect",Ml="@firebase/database-compat",xl="@firebase/functions",Fl="@firebase/functions-compat",Ul="@firebase/installations",Wl="@firebase/installations-compat",Vl="@firebase/messaging",Bl="@firebase/messaging-compat",Hl="@firebase/performance",$l="@firebase/performance-compat",jl="@firebase/remote-config",zl="@firebase/remote-config-compat",ql="@firebase/storage",Gl="@firebase/storage-compat",Kl="@firebase/firestore",Yl="@firebase/ai",Jl="@firebase/firestore-compat",Ql="firebase",Xl="11.10.0";var Di="[DEFAULT]",Zl={[Oi]:"fire-core",[Sl]:"fire-core-compat",[kl]:"fire-analytics",[Al]:"fire-analytics-compat",[Pl]:"fire-app-check",[Rl]:"fire-app-check-compat",[Nl]:"fire-auth",[Ol]:"fire-auth-compat",[Dl]:"fire-rtdb",[Ll]:"fire-data-connect",[Ml]:"fire-rtdb-compat",[xl]:"fire-fn",[Fl]:"fire-fn-compat",[Ul]:"fire-iid",[Wl]:"fire-iid-compat",[Vl]:"fire-fcm",[Bl]:"fire-fcm-compat",[Hl]:"fire-perf",[$l]:"fire-perf-compat",[jl]:"fire-rc",[zl]:"fire-rc-compat",[ql]:"fire-gcs",[Gl]:"fire-gcs-compat",[Kl]:"fire-fst",[Jl]:"fire-fst-compat",[Yl]:"fire-vertex","fire-js":"fire-js",[Ql]:"fire-js-all"};var vt=new Map,eu=new Map,Li=new Map;function po(n,e){try{n.container.addComponent(e)}catch(t){le.debug(`Component ${e.name} failed to register with FirebaseApp ${n.name}`,t)}}function K(n){let e=n.name;if(Li.has(e))return le.debug(`There were multiple attempts to register component ${e}.`),!1;Li.set(e,n);for(let t of vt.values())po(t,n);for(let t of eu.values())po(t,n);return!0}function ln(n,e){let t=n.container.getProvider("heartbeat").getImmediate({optional:!0});return t&&t.triggerHeartbeat(),n.container.getProvider(e)}function ue(n){return n==null?!1:n.settings!==void 0}var tu={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},pe=new q("app","Firebase",tu);var Mi=class{constructor(e,t,i){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new L("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw pe.create("app-deleted",{appName:this._name})}};var qe=Xl;function Ui(n,e={}){let t=n;typeof e!="object"&&(e={name:e});let i=Object.assign({name:Di,automaticDataCollectionEnabled:!0},e),r=i.name;if(typeof r!="string"||!r)throw pe.create("bad-app-name",{appName:String(r)});if(t||(t=wi()),!t)throw pe.create("no-options");let s=vt.get(r);if(s){if(Ce(t,s.options)&&Ce(i,s.config))return s;throw pe.create("duplicate-app",{appName:r})}let o=new gt(r);for(let c of Li.values())o.addComponent(c);let a=new Mi(t,i,o);return vt.set(r,a),a}function Ge(n=Di){let e=vt.get(n);if(!e&&n===Di&&wi())return Ui();if(!e)throw pe.create("no-app",{appName:n});return e}function un(){return Array.from(vt.values())}function R(n,e,t){var i;let r=(i=Zl[n])!==null&&i!==void 0?i:n;t&&(r+=`-${t}`);let s=r.match(/\s|\//),o=e.match(/\s|\//);if(s||o){let a=[`Unable to register library "${r}" with version "${e}":`];s&&a.push(`library name "${r}" contains illegal characters (whitespace or "/")`),s&&o&&a.push("and"),o&&a.push(`version name "${e}" contains illegal characters (whitespace or "/")`),le.warn(a.join(" "));return}K(new L(`${r}-version`,()=>({library:r,version:e}),"VERSION"))}var nu="firebase-heartbeat-database",iu=1,yt="firebase-heartbeat-store",Pi=null;function vo(){return Pi||(Pi=ho(nu,iu,{upgrade:(n,e)=>{switch(e){case 0:try{n.createObjectStore(yt)}catch(t){console.warn(t)}}}}).catch(n=>{throw pe.create("idb-open",{originalErrorMessage:n.message})})),Pi}function ru(n){return _(this,null,function*(){try{let t=(yield vo()).transaction(yt),i=yield t.objectStore(yt).get(yo(n));return yield t.done,i}catch(e){if(e instanceof Z)le.warn(e.message);else{let t=pe.create("idb-get",{originalErrorMessage:e?.message});le.warn(t.message)}}})}function _o(n,e){return _(this,null,function*(){try{let i=(yield vo()).transaction(yt,"readwrite");yield i.objectStore(yt).put(e,yo(n)),yield i.done}catch(t){if(t instanceof Z)le.warn(t.message);else{let i=pe.create("idb-set",{originalErrorMessage:t?.message});le.warn(i.message)}}})}function yo(n){return`${n.name}!${n.options.appId}`}var su=1024,ou=30,xi=class{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Fi(t),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}triggerHeartbeat(){return _(this,null,function*(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),s=mo();if(((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null&&(this._heartbeatsCache=yield this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===s||this._heartbeatsCache.heartbeats.some(o=>o.date===s))return;if(this._heartbeatsCache.heartbeats.push({date:s,agent:r}),this._heartbeatsCache.heartbeats.length>ou){let o=cu(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(o,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(i){le.warn(i)}})}getHeartbeatsHeader(){return _(this,null,function*(){var e;try{if(this._heartbeatsCache===null&&(yield this._heartbeatsCachePromise),((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";let t=mo(),{heartbeatsToSend:i,unsentEntries:r}=au(this._heartbeatsCache.heartbeats),s=ht(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=t,r.length>0?(this._heartbeatsCache.heartbeats=r,yield this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return le.warn(t),""}})}};function mo(){return new Date().toISOString().substring(0,10)}function au(n,e=su){let t=[],i=n.slice();for(let r of n){let s=t.find(o=>o.agent===r.agent);if(s){if(s.dates.push(r.date),go(t)>e){s.dates.pop();break}}else if(t.push({agent:r.agent,dates:[r.date]}),go(t)>e){t.pop();break}i=i.slice(1)}return{heartbeatsToSend:t,unsentEntries:i}}var Fi=class{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}runIndexedDBEnvironmentCheck(){return _(this,null,function*(){return rn()?Zs().then(()=>!0).catch(()=>!1):!1})}read(){return _(this,null,function*(){if(yield this._canUseIndexedDBPromise){let t=yield ru(this.app);return t?.heartbeats?t:{heartbeats:[]}}else return{heartbeats:[]}})}overwrite(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return _o(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}else return})}add(e){return _(this,null,function*(){var t;if(yield this._canUseIndexedDBPromise){let r=yield this.read();return _o(this.app,{lastSentHeartbeatDate:(t=e.lastSentHeartbeatDate)!==null&&t!==void 0?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}else return})}};function go(n){return ht(JSON.stringify({version:2,heartbeats:n})).length}function cu(n){if(n.length===0)return-1;let e=0,t=n[0].date;for(let i=1;i<n.length;i++)n[i].date<t&&(t=n[i].date,e=i);return e}function lu(n){K(new L("platform-logger",e=>new Ni(e),"PRIVATE")),K(new L("heartbeat",e=>new xi(e),"PRIVATE")),R(Oi,fo,n),R(Oi,fo,"esm2017"),R("fire-js","")}lu("");var uu="firebase",du="11.10.0";R(uu,du,"app");function Io(n){n===void 0&&(n=ce(He));let e=n.get(en);return t=>new ut(i=>{let r=e.add(),s=!1;function o(){s||(r(),s=!0)}let a=t.subscribe({next:c=>{i.next(c),o()},complete:()=>{i.complete(),o()},error:c=>{i.error(c),o()}});return a.add(()=>{i.unsubscribe(),o()}),a})}var Ae=new Ms("ANGULARFIRE2_VERSION");function hn(n,e,t){if(e){if(e.length===1)return e[0];let s=e.filter(o=>o.app===t);if(s.length===1)return s[0]}return t.container.getProvider(n).getImmediate({optional:!0})}var Ye=(n,e)=>{let t=e?[e]:un(),i=[];return t.forEach(r=>{r.container.getProvider(n).instances.forEach(o=>{i.includes(o)||i.push(o)})}),i},Ke=(function(n){return n[n.SILENT=0]="SILENT",n[n.WARN=1]="WARN",n[n.VERBOSE=2]="VERBOSE",n})(Ke||{}),Eo=_i()&&typeof Zone<"u"?Ke.WARN:Ke.SILENT;var dn=class{zone;delegate;constructor(e,t=Ls){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,i){let r=this.zone,s=function(o){r?r.runGuarded(()=>{e.apply(this,[o])}):e.apply(this,[o])};return this.delegate.schedule(s,t,i)}},ke=(()=>{class n{outsideAngular;insideAngular;constructor(){let t=ce(fe);this.outsideAngular=t.runOutsideAngular(()=>new dn(typeof Zone>"u"?void 0:Zone.current)),this.insideAngular=t.run(()=>new dn(typeof Zone>"u"?void 0:Zone.current,Ds))}static \u0275fac=function(i){return new(i||n)};static \u0275prov=Fs({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})(),wo=!1;function hu(n,e){!wo&&(Eo>Ke.SILENT||_i())&&(wo=!0,console.warn("Calling Firebase APIs outside of an Injection context may destabilize your application leading to subtle change-detection and hydration bugs. Find more at https://github.com/angular/angularfire/blob/main/docs/zones.md")),Eo>=e&&console.warn(`Firebase API called outside injection context: ${n.name}`)}function fu(n){let e=ce(fe,{optional:!0});return e?e.runOutsideAngular(()=>n()):n()}function Se(n){let e=ce(fe,{optional:!0});return e?e.run(()=>n()):n()}var pu=(n,e,t)=>(...i)=>(e&&setTimeout(e,0),Zt(t,()=>Se(()=>n.apply(void 0,i)))),H=(n,e,t)=>(t||=e?Ke.WARN:Ke.VERBOSE,function(){let i,r=arguments,s,o,a;try{s=ce(ke),o=ce(en),a=ce(Us)}catch{return hu(n,t),n.apply(this,r)}for(let l=0;l<arguments.length;l++)typeof r[l]=="function"&&(e&&(i||=Se(()=>o.add())),r[l]=pu(r[l],i,a));let c=fu(()=>n.apply(this,r));return e?c instanceof ut?c.pipe(pi(s.outsideAngular),fi(s.insideAngular),Io(a)):c instanceof Promise?Se(()=>{let l=o.add();return new Promise((h,d)=>{c.then(u=>Zt(a,()=>Se(()=>h(u))),u=>Zt(a,()=>Se(()=>d(u)))).finally(l)})}):typeof c=="function"&&i?function(){return setTimeout(i,0),c.apply(this,arguments)}:Se(()=>c):c instanceof ut?c.pipe(pi(s.outsideAngular),fi(s.insideAngular)):Se(()=>c)});var Re=class{constructor(e){return e}},It=class{constructor(){return un()}};function _u(n){return n&&n.length===1?n[0]:new Re(Ge())}var Wi=new Qt("angularfire2._apps"),mu={provide:Re,useFactory:_u,deps:[[new he,Wi]]},gu={provide:It,deps:[[new he,Wi]]};function vu(n){return(e,t)=>{let i=t.get(Ws);R("angularfire",Ae.full,"core"),R("angularfire",Ae.full,"app"),R("angular",xs.full,i.toString());let r=e.runOutsideAngular(()=>n(t));return new Re(r)}}function sm(n,...e){return Xt([mu,gu,{provide:Wi,useFactory:vu(n),multi:!0,deps:[fe,He,ke,...e]}])}var om=H(Ui,!0);var yu=new Map,Iu={activated:!1,tokenObservers:[]},Eu={initialized:!1,enabled:!1};function Y(n){return yu.get(n)||Object.assign({},Iu)}function So(){return Eu}var wu="https://content-firebaseappcheck.googleapis.com/v1";var Tu="exchangeDebugToken",To={OFFSET_DURATION:300*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:960*1e3},_m=1440*60*1e3;var Hi=class{constructor(e,t,i,r,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=i,this.lowerBound=r,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=r,r>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return _(this,null,function*(){this.stop();try{this.pending=new z,this.pending.promise.catch(t=>{}),yield Cu(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new z,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function Cu(n){return new Promise(e=>{setTimeout(e,n)})}var bu={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.","initial-throttle":"{$httpStatus} error. Attempts allowed again after {$time}",throttled:"Requests throttled due to previous {$httpStatus} error. Attempts allowed again after {$time}"},_e=new q("appCheck","AppCheck",bu);function Ao(n){if(!Y(n).activated)throw _e.create("use-before-activation",{appName:n.name})}function ko(i,r){return _(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let f=yield o.getHeartbeatsHeader();f&&(s["X-Firebase-Client"]=f)}let a={method:"POST",body:JSON.stringify(e),headers:s},c;try{c=yield fetch(n,a)}catch(f){throw _e.create("fetch-network-error",{originalErrorMessage:f?.message})}if(c.status!==200)throw _e.create("fetch-status-error",{httpStatus:c.status});let l;try{l=yield c.json()}catch(f){throw _e.create("fetch-parse-error",{originalErrorMessage:f?.message})}let h=l.ttl.match(/^([\d.]+)(s)$/);if(!h||!h[2]||isNaN(Number(h[1])))throw _e.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${l.ttl}`});let d=Number(h[1])*1e3,u=Date.now();return{token:l.token,expireTimeMillis:u+d,issuedAtTimeMillis:u}})}function Ro(n,e){let{projectId:t,appId:i,apiKey:r}=n.options;return{url:`${wu}/projects/${t}/apps/${i}:${Tu}?key=${r}`,body:{debug_token:e}}}var Su="firebase-app-check-database",Au=1,$i="firebase-app-check-store";var fn=null;function ku(){return fn||(fn=new Promise((n,e)=>{try{let t=indexedDB.open(Su,Au);t.onsuccess=i=>{n(i.target.result)},t.onerror=i=>{var r;e(_e.create("storage-open",{originalErrorMessage:(r=i.target.error)===null||r===void 0?void 0:r.message}))},t.onupgradeneeded=i=>{let r=i.target.result;switch(i.oldVersion){case 0:r.createObjectStore($i,{keyPath:"compositeKey"})}}}catch(t){e(_e.create("storage-open",{originalErrorMessage:t?.message}))}}),fn)}function Ru(n,e){return Pu(Nu(n),e)}function Pu(n,e){return _(this,null,function*(){let i=(yield ku()).transaction($i,"readwrite"),s=i.objectStore($i).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=c=>{o()},i.onerror=c=>{var l;a(_e.create("storage-set",{originalErrorMessage:(l=c.target.error)===null||l===void 0?void 0:l.message}))}})})}function Nu(n){return`${n.options.appId}-${n.name}`}var Et=new ne("@firebase/app-check");function Vi(n,e){return rn()?Ru(n,e).catch(t=>{Et.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function Po(){return So().enabled}function No(){return _(this,null,function*(){let n=So();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var Ou={error:"UNKNOWN_ERROR"};function Du(n){return ze.encodeString(JSON.stringify(n),!1)}function ji(n,e=!1,t=!1){return _(this,null,function*(){let i=n.app;Ao(i);let r=Y(i),s=r.token,o;if(s&&!wt(s)&&(r.token=void 0,s=void 0),!s){let l=yield r.cachedTokenPromise;l&&(wt(l)?s=l:yield Vi(i,void 0))}if(!e&&s&&wt(s))return{token:s.token};let a=!1;if(Po())try{r.exchangeTokenPromise||(r.exchangeTokenPromise=ko(Ro(i,yield No()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),a=!0);let l=yield r.exchangeTokenPromise;return yield Vi(i,l),r.token=l,{token:l.token}}catch(l){return l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?Et.warn(l.message):t&&Et.error(l),Bi(l)}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),a=!0),s=yield Y(i).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"||l.code==="appCheck/initial-throttle"?Et.warn(l.message):t&&Et.error(l),o=l}let c;return s?o?wt(s)?c={token:s.token,internalError:o}:c=Bi(o):(c={token:s.token},r.token=s,yield Vi(i,s)):c=Bi(o),a&&Fu(i,c),c})}function Lu(n){return _(this,null,function*(){let e=n.app;Ao(e);let{provider:t}=Y(e);if(Po()){let i=yield No(),{token:r}=yield ko(Ro(e,i),n.heartbeatServiceProvider);return{token:r}}else{let{token:i}=yield t.getToken();return{token:i}}})}function Mu(n,e,t,i){let{app:r}=n,s=Y(r),o={next:t,error:i,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&wt(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Co(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Co(n))}function Oo(n,e){let t=Y(n),i=t.tokenObservers.filter(r=>r.next!==e);i.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=i}function Co(n){let{app:e}=n,t=Y(e),i=t.tokenRefresher;i||(i=xu(n),t.tokenRefresher=i),!i.isRunning()&&t.isTokenAutoRefreshEnabled&&i.start()}function xu(n){let{app:e}=n;return new Hi(()=>_(null,null,function*(){let t=Y(e),i;if(t.token?i=yield ji(n,!0):i=yield ji(n),i.error)throw i.error;if(i.internalError)throw i.internalError}),()=>!0,()=>{let t=Y(e);if(t.token){let i=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,r=t.token.expireTimeMillis-300*1e3;return i=Math.min(i,r),Math.max(0,i-Date.now())}else return 0},To.RETRIAL_MIN_WAIT,To.RETRIAL_MAX_WAIT)}function Fu(n,e){let t=Y(n).tokenObservers;for(let i of t)try{i.type==="EXTERNAL"&&e.error!=null?i.error(e.error):i.next(e)}catch{}}function wt(n){return n.expireTimeMillis-Date.now()>0}function Bi(n){return{token:Du(Ou),error:n}}var zi=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=Y(this.app);for(let t of e)Oo(this.app,t.next);return Promise.resolve()}};function Uu(n,e){return new zi(n,e)}function Wu(n){return{getToken:e=>ji(n,e),getLimitedUseToken:()=>Lu(n),addTokenListener:e=>Mu(n,"INTERNAL",e),removeTokenListener:e=>Oo(n.app,e)}}var Vu="@firebase/app-check",Bu="0.10.1";var Hu="app-check",bo="app-check-internal";function $u(){K(new L(Hu,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return Uu(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(bo).initialize()})),K(new L(bo,n=>{let e=n.getProvider("app-check").getImmediate();return Wu(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),R(Vu,Bu)}$u();var ju="app-check";var pn=class{constructor(){return Ye(ju)}};var zu=["localhost","0.0.0.0","127.0.0.1"],km=typeof window<"u"&&zu.includes(window.location.hostname);function Vo(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}var Bo=Vo,Ho=new q("auth","Firebase",Vo());var vn=new ne("@firebase/auth");function qu(n,...e){vn.logLevel<=C.WARN&&vn.warn(`Auth (${qe}): ${n}`,...e)}function mn(n,...e){vn.logLevel<=C.ERROR&&vn.error(`Auth (${qe}): ${n}`,...e)}function Do(n,...e){throw ir(n,...e)}function nr(n,...e){return ir(n,...e)}function $o(n,e,t){let i=Object.assign(Object.assign({},Bo()),{[e]:t});return new q("auth","Firebase",i).create(e,{appName:n.name})}function gn(n){return $o(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function ir(n,...e){if(typeof n!="string"){let t=e[0],i=[...e.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(t,...i)}return Ho.create(n,...e)}function T(n,e,...t){if(!n)throw ir(e,...t)}function Tt(n){let e="INTERNAL ASSERTION FAILED: "+n;throw mn(e),new Error(e)}function yn(n,e){n||Tt(e)}function Gu(){return Lo()==="http:"||Lo()==="https:"}function Lo(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}function Ku(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Gu()||Xs()||"connection"in navigator)?navigator.onLine:!0}function Yu(){if(typeof navigator>"u")return null;let n=navigator;return n.languages&&n.languages[0]||n.language||null}var Oe=class{constructor(e,t){this.shortDelay=e,this.longDelay=t,yn(t>e,"Short delay should be less than long delay!"),this.isMobile=ft()||nn()}get(){return Ku()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}};function Ju(n,e){yn(n.emulator,"Emulator should always be set here");let{url:t}=n.emulator;return e?`${t}${e.startsWith("/")?e.slice(1):e}`:t}var In=class{static initialize(e,t,i){this.fetchImpl=e,t&&(this.headersImpl=t),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Tt("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Tt("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Tt("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}};var Qu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};var Xu=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Zu=new Oe(3e4,6e4);function jo(n,e){return n.tenantId&&!e.tenantId?Object.assign(Object.assign({},e),{tenantId:n.tenantId}):e}function bn(s,o,a,c){return _(this,arguments,function*(n,e,t,i,r={}){return zo(n,r,()=>_(null,null,function*(){let l={},h={};i&&(e==="GET"?h=i:l={body:JSON.stringify(i)});let d=_t(Object.assign({key:n.config.apiKey},h)).slice(1),u=yield n._getAdditionalHeaders();u["Content-Type"]="application/json",n.languageCode&&(u["X-Firebase-Locale"]=n.languageCode);let f=Object.assign({method:e,headers:u},l);return Qs()||(f.referrerPolicy="no-referrer"),n.emulatorConfig&&we(n.emulatorConfig.host)&&(f.credentials="include"),In.fetch()(yield qo(n,n.config.apiHost,t,d),f)}))})}function zo(n,e,t){return _(this,null,function*(){n._canInitEmulator=!1;let i=Object.assign(Object.assign({},Qu),e);try{let r=new Ki(n),s=yield Promise.race([t(),r.promise]);r.clearNetworkTimeout();let o=yield s.json();if("needConfirmation"in o)throw _n(n,"account-exists-with-different-credential",o);if(s.ok&&!("errorMessage"in o))return o;{let a=s.ok?o.errorMessage:o.error.message,[c,l]=a.split(" : ");if(c==="FEDERATED_USER_ID_ALREADY_LINKED")throw _n(n,"credential-already-in-use",o);if(c==="EMAIL_EXISTS")throw _n(n,"email-already-in-use",o);if(c==="USER_DISABLED")throw _n(n,"user-disabled",o);let h=i[c]||c.toLowerCase().replace(/[_\s]+/g,"-");if(l)throw $o(n,h,l);Do(n,h)}}catch(r){if(r instanceof Z)throw r;Do(n,"network-request-failed",{message:String(r)})}})}function qo(n,e,t,i){return _(this,null,function*(){let r=`${e}${t}?${i}`,s=n,o=s.config.emulator?Ju(n.config,r):`${n.config.apiScheme}://${r}`;return Xu.includes(t)&&(yield s._persistenceManagerAvailable,s._getPersistenceType()==="COOKIE")?s._getPersistence()._getFinalTarget(o).toString():o})}var Ki=class{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(e){this.auth=e,this.timer=null,this.promise=new Promise((t,i)=>{this.timer=setTimeout(()=>i(nr(this.auth,"network-request-failed")),Zu.get())})}};function _n(n,e,t){let i={appName:n.name};t.email&&(i.email=t.email),t.phoneNumber&&(i.phoneNumber=t.phoneNumber);let r=nr(n,e,i);return r.customData._tokenResponse=t,r}function ed(n,e){return _(this,null,function*(){return bn(n,"POST","/v1/accounts:delete",e)})}function En(n,e){return _(this,null,function*(){return bn(n,"POST","/v1/accounts:lookup",e)})}function Ct(n){if(n)try{let e=new Date(Number(n));if(!isNaN(e.getTime()))return e.toUTCString()}catch{}}function rr(n,e=!1){return _(this,null,function*(){let t=x(n),i=yield t.getIdToken(e),r=Go(i);T(r&&r.exp&&r.auth_time&&r.iat,t.auth,"internal-error");let s=typeof r.firebase=="object"?r.firebase:void 0,o=s?.sign_in_provider;return{claims:r,token:i,authTime:Ct(qi(r.auth_time)),issuedAtTime:Ct(qi(r.iat)),expirationTime:Ct(qi(r.exp)),signInProvider:o||null,signInSecondFactor:s?.sign_in_second_factor||null}})}function qi(n){return Number(n)*1e3}function Go(n){let[e,t,i]=n.split(".");if(e===void 0||t===void 0||i===void 0)return mn("JWT malformed, contained fewer than 3 sections"),null;try{let r=$e(t);return r?JSON.parse(r):(mn("Failed to decode base64 JWT payload"),null)}catch(r){return mn("Caught error parsing JWT payload as JSON",r?.toString()),null}}function Mo(n){let e=Go(n);return T(e,"internal-error"),T(typeof e.exp<"u","internal-error"),T(typeof e.iat<"u","internal-error"),Number(e.exp)-Number(e.iat)}function Yi(n,e,t=!1){return _(this,null,function*(){if(t)return e;try{return yield e}catch(i){throw i instanceof Z&&td(i)&&n.auth.currentUser===n&&(yield n.auth.signOut()),i}})}function td({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}var Ji=class{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){let i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;let r=((t=this.user.stsTokenManager.expirationTime)!==null&&t!==void 0?t:0)-Date.now()-3e5;return Math.max(0,r)}}schedule(e=!1){if(!this.isRunning)return;let t=this.getInterval(e);this.timerId=setTimeout(()=>_(this,null,function*(){yield this.iteration()}),t)}iteration(){return _(this,null,function*(){try{yield this.user.getIdToken(!0)}catch(e){e?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()})}};var St=class{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Ct(this.lastLoginAt),this.creationTime=Ct(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}};function wn(n){return _(this,null,function*(){var e;let t=n.auth,i=yield n.getIdToken(),r=yield Yi(n,En(t,{idToken:i}));T(r?.users.length,t,"internal-error");let s=r.users[0];n._notifyReloadListener(s);let o=!((e=s.providerUserInfo)===null||e===void 0)&&e.length?Ko(s.providerUserInfo):[],a=nd(n.providerData,o),c=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!a?.length,h=c?l:!1,d={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:a,metadata:new St(s.createdAt,s.lastLoginAt),isAnonymous:h};Object.assign(n,d)})}function sr(n){return _(this,null,function*(){let e=x(n);yield wn(e),yield e.auth._persistUserIfCurrent(e),e.auth._notifyListenersIfCurrent(e)})}function nd(n,e){return[...n.filter(i=>!e.some(r=>r.providerId===i.providerId)),...e]}function Ko(n){return n.map(e=>{var{providerId:t}=e,i=hi(e,["providerId"]);return{providerId:t,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}function id(n,e){return _(this,null,function*(){let t=yield zo(n,{},()=>_(null,null,function*(){let i=_t({grant_type:"refresh_token",refresh_token:e}).slice(1),{tokenApiHost:r,apiKey:s}=n.config,o=yield qo(n,r,"/v1/token",`key=${s}`),a=yield n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";let c={method:"POST",headers:a,body:i};return n.emulatorConfig&&we(n.emulatorConfig.host)&&(c.credentials="include"),In.fetch()(o,c)}));return{accessToken:t.access_token,expiresIn:t.expires_in,refreshToken:t.refresh_token}})}function rd(n,e){return _(this,null,function*(){return bn(n,"POST","/v2/accounts:revokeToken",jo(n,e))})}var bt=class n{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){T(e.idToken,"internal-error"),T(typeof e.idToken<"u","internal-error"),T(typeof e.refreshToken<"u","internal-error");let t="expiresIn"in e&&typeof e.expiresIn<"u"?Number(e.expiresIn):Mo(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}updateFromIdToken(e){T(e.length!==0,"internal-error");let t=Mo(e);this.updateTokensAndExpiration(e,null,t)}getToken(e,t=!1){return _(this,null,function*(){return!t&&this.accessToken&&!this.isExpired?this.accessToken:(T(this.refreshToken,e,"user-token-expired"),this.refreshToken?(yield this.refresh(e,this.refreshToken),this.accessToken):null)})}clearRefreshToken(){this.refreshToken=null}refresh(e,t){return _(this,null,function*(){let{accessToken:i,refreshToken:r,expiresIn:s}=yield id(e,t);this.updateTokensAndExpiration(i,r,Number(s))})}updateTokensAndExpiration(e,t,i){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(e,t){let{refreshToken:i,accessToken:r,expirationTime:s}=t,o=new n;return i&&(T(typeof i=="string","internal-error",{appName:e}),o.refreshToken=i),r&&(T(typeof r=="string","internal-error",{appName:e}),o.accessToken=r),s&&(T(typeof s=="number","internal-error",{appName:e}),o.expirationTime=s),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new n,this.toJSON())}_performRefresh(){return Tt("not implemented")}};function me(n,e){T(typeof n=="string"||typeof n>"u","internal-error",{appName:e})}var Pe=class n{constructor(e){var{uid:t,auth:i,stsTokenManager:r}=e,s=hi(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Ji(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=i,this.stsTokenManager=r,this.accessToken=r.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new St(s.createdAt||void 0,s.lastLoginAt||void 0)}getIdToken(e){return _(this,null,function*(){let t=yield Yi(this,this.stsTokenManager.getToken(this.auth,e));return T(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,yield this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t})}getIdTokenResult(e){return rr(this,e)}reload(){return sr(this)}_assign(e){this!==e&&(T(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map(t=>Object.assign({},t)),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){let t=new n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}));return t.metadata._copy(this.metadata),t}_onReload(e){T(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}_updateTokensIfNecessary(e,t=!1){return _(this,null,function*(){let i=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),i=!0),t&&(yield wn(this)),yield this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)})}delete(){return _(this,null,function*(){if(ue(this.auth.app))return Promise.reject(gn(this.auth));let e=yield this.getIdToken();return yield Yi(this,ed(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()})}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(e=>Object.assign({},e)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var i,r,s,o,a,c,l,h;let d=(i=t.displayName)!==null&&i!==void 0?i:void 0,u=(r=t.email)!==null&&r!==void 0?r:void 0,f=(s=t.phoneNumber)!==null&&s!==void 0?s:void 0,m=(o=t.photoURL)!==null&&o!==void 0?o:void 0,E=(a=t.tenantId)!==null&&a!==void 0?a:void 0,A=(c=t._redirectEventId)!==null&&c!==void 0?c:void 0,V=(l=t.createdAt)!==null&&l!==void 0?l:void 0,B=(h=t.lastLoginAt)!==null&&h!==void 0?h:void 0,{uid:j,emailVerified:Be,isAnonymous:Ns,providerData:ci,stsTokenManager:Os}=t;T(j&&Os,e,"internal-error");let Jc=bt.fromJSON(this.name,Os);T(typeof j=="string",e,"internal-error"),me(d,e.name),me(u,e.name),T(typeof Be=="boolean",e,"internal-error"),T(typeof Ns=="boolean",e,"internal-error"),me(f,e.name),me(m,e.name),me(E,e.name),me(A,e.name),me(V,e.name),me(B,e.name);let li=new n({uid:j,auth:e,email:u,emailVerified:Be,displayName:d,isAnonymous:Ns,photoURL:m,phoneNumber:f,tenantId:E,stsTokenManager:Jc,createdAt:V,lastLoginAt:B});return ci&&Array.isArray(ci)&&(li.providerData=ci.map(Qc=>Object.assign({},Qc))),A&&(li._redirectEventId=A),li}static _fromIdTokenResponse(e,t,i=!1){return _(this,null,function*(){let r=new bt;r.updateFromServerResponse(t);let s=new n({uid:t.localId,auth:e,stsTokenManager:r,isAnonymous:i});return yield wn(s),s})}static _fromGetAccountInfoResponse(e,t,i){return _(this,null,function*(){let r=t.users[0];T(r.localId!==void 0,"internal-error");let s=r.providerUserInfo!==void 0?Ko(r.providerUserInfo):[],o=!(r.email&&r.passwordHash)&&!s?.length,a=new bt;a.updateFromIdToken(i);let c=new n({uid:r.localId,auth:e,stsTokenManager:a,isAnonymous:o}),l={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:s,metadata:new St(r.createdAt,r.lastLoginAt),isAnonymous:!(r.email&&r.passwordHash)&&!s?.length};return Object.assign(c,l),c})}};var xo=new Map;function Ne(n){yn(n instanceof Function,"Expected a class definition");let e=xo.get(n);return e?(yn(e instanceof n,"Instance stored in cache mismatched with class"),e):(e=new n,xo.set(n,e),e)}var sd=(()=>{class n{constructor(){this.type="NONE",this.storage={}}_isAvailable(){return _(this,null,function*(){return!0})}_set(t,i){return _(this,null,function*(){this.storage[t]=i})}_get(t){return _(this,null,function*(){let i=this.storage[t];return i===void 0?null:i})}_remove(t){return _(this,null,function*(){delete this.storage[t]})}_addListener(t,i){}_removeListener(t,i){}}return n.type="NONE",n})(),Qi=sd;function Gi(n,e,t){return`firebase:${n}:${e}:${t}`}var Tn=class n{constructor(e,t,i){this.persistence=e,this.auth=t,this.userKey=i;let{config:r,name:s}=this.auth;this.fullUserKey=Gi(this.userKey,r.apiKey,s),this.fullPersistenceKey=Gi("persistence",r.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}getCurrentUser(){return _(this,null,function*(){let e=yield this.persistence._get(this.fullUserKey);if(!e)return null;if(typeof e=="string"){let t=yield En(this.auth,{idToken:e}).catch(()=>{});return t?Pe._fromGetAccountInfoResponse(this.auth,t,e):null}return Pe._fromJSON(this.auth,e)})}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}setPersistence(e){return _(this,null,function*(){if(this.persistence===e)return;let t=yield this.getCurrentUser();if(yield this.removeCurrentUser(),this.persistence=e,t)return this.setCurrentUser(t)})}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static create(e,t,i="authUser"){return _(this,null,function*(){if(!t.length)return new n(Ne(Qi),e,i);let r=(yield Promise.all(t.map(l=>_(null,null,function*(){if(yield l._isAvailable())return l})))).filter(l=>l),s=r[0]||Ne(Qi),o=Gi(i,e.config.apiKey,e.name),a=null;for(let l of t)try{let h=yield l._get(o);if(h){let d;if(typeof h=="string"){let u=yield En(e,{idToken:h}).catch(()=>{});if(!u)break;d=yield Pe._fromGetAccountInfoResponse(e,u,h)}else d=Pe._fromJSON(e,h);l!==s&&(a=d),s=l;break}}catch{}let c=r.filter(l=>l._shouldAllowMigration);return!s._shouldAllowMigration||!c.length?new n(s,e,i):(s=c[0],a&&(yield s._set(o,a.toJSON())),yield Promise.all(t.map(l=>_(null,null,function*(){if(l!==s)try{yield l._remove(o)}catch{}}))),new n(s,e,i))})}};function Fo(n){let e=n.toLowerCase();if(e.includes("opera/")||e.includes("opr/")||e.includes("opios/"))return"Opera";if(ld(e))return"IEMobile";if(e.includes("msie")||e.includes("trident/"))return"IE";if(e.includes("edge/"))return"Edge";if(od(e))return"Firefox";if(e.includes("silk/"))return"Silk";if(dd(e))return"Blackberry";if(hd(e))return"Webos";if(ad(e))return"Safari";if((e.includes("chrome/")||cd(e))&&!e.includes("edge/"))return"Chrome";if(ud(e))return"Android";{let t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(t);if(i?.length===2)return i[1]}return"Other"}function od(n=G()){return/firefox\//i.test(n)}function ad(n=G()){let e=n.toLowerCase();return e.includes("safari/")&&!e.includes("chrome/")&&!e.includes("crios/")&&!e.includes("android")}function cd(n=G()){return/crios\//i.test(n)}function ld(n=G()){return/iemobile/i.test(n)}function ud(n=G()){return/android/i.test(n)}function dd(n=G()){return/blackberry/i.test(n)}function hd(n=G()){return/webos/i.test(n)}function Yo(n,e=[]){let t;switch(n){case"Browser":t=Fo(G());break;case"Worker":t=`${Fo(G())}-${n}`;break;default:t=n}let i=e.length?e.join(","):"FirebaseCore-web";return`${t}/JsCore/${qe}/${i}`}var Xi=class{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){let i=s=>new Promise((o,a)=>{try{let c=e(s);o(c)}catch(c){a(c)}});i.onAbort=t,this.queue.push(i);let r=this.queue.length-1;return()=>{this.queue[r]=()=>Promise.resolve()}}runMiddleware(e){return _(this,null,function*(){if(this.auth.currentUser===e)return;let t=[];try{for(let i of this.queue)yield i(e),i.onAbort&&t.push(i.onAbort)}catch(i){t.reverse();for(let r of t)try{r()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}})}};function fd(t){return _(this,arguments,function*(n,e={}){return bn(n,"GET","/v2/passwordPolicy",jo(n,e))})}var pd=6,Zi=class{constructor(e){var t,i,r,s;let o=e.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(t=o.minPasswordLength)!==null&&t!==void 0?t:pd,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=e.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(r=(i=e.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&r!==void 0?r:"",this.forceUpgradeOnSignin=(s=e.forceUpgradeOnSignin)!==null&&s!==void 0?s:!1,this.schemaVersion=e.schemaVersion}validatePassword(e){var t,i,r,s,o,a;let c={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(e,c),this.validatePasswordCharacterOptions(e,c),c.isValid&&(c.isValid=(t=c.meetsMinPasswordLength)!==null&&t!==void 0?t:!0),c.isValid&&(c.isValid=(i=c.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),c.isValid&&(c.isValid=(r=c.containsLowercaseLetter)!==null&&r!==void 0?r:!0),c.isValid&&(c.isValid=(s=c.containsUppercaseLetter)!==null&&s!==void 0?s:!0),c.isValid&&(c.isValid=(o=c.containsNumericCharacter)!==null&&o!==void 0?o:!0),c.isValid&&(c.isValid=(a=c.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),c}validatePasswordLengthOptions(e,t){let i=this.customStrengthOptions.minPasswordLength,r=this.customStrengthOptions.maxPasswordLength;i&&(t.meetsMinPasswordLength=e.length>=i),r&&(t.meetsMaxPasswordLength=e.length<=r)}validatePasswordCharacterOptions(e,t){this.updatePasswordCharacterOptionsStatuses(t,!1,!1,!1,!1);let i;for(let r=0;r<e.length;r++)i=e.charAt(r),this.updatePasswordCharacterOptionsStatuses(t,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(e,t,i,r,s){this.customStrengthOptions.containsLowercaseLetter&&(e.containsLowercaseLetter||(e.containsLowercaseLetter=t)),this.customStrengthOptions.containsUppercaseLetter&&(e.containsUppercaseLetter||(e.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(e.containsNumericCharacter||(e.containsNumericCharacter=r)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(e.containsNonAlphanumericCharacter||(e.containsNonAlphanumericCharacter=s))}};var er=class{constructor(e,t,i,r){this.app=e,this.heartbeatServiceProvider=t,this.appCheckServiceProvider=i,this.config=r,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Cn(this),this.idTokenSubscription=new Cn(this),this.beforeStateQueue=new Xi(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Ho,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=r.sdkClientVersion,this._persistenceManagerAvailable=new Promise(s=>this._resolvePersistenceManagerAvailable=s)}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=Ne(t)),this._initializationPromise=this.queue(()=>_(this,null,function*(){var i,r,s;if(!this._deleted&&(this.persistenceManager=yield Tn.create(this,e),(i=this._resolvePersistenceManagerAvailable)===null||i===void 0||i.call(this),!this._deleted)){if(!((r=this._popupRedirectResolver)===null||r===void 0)&&r._shouldInitProactively)try{yield this._popupRedirectResolver._initialize(this)}catch{}yield this.initializeCurrentUser(t),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}})),this._initializationPromise}_onStorageEvent(){return _(this,null,function*(){if(this._deleted)return;let e=yield this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!e)){if(this.currentUser&&e&&this.currentUser.uid===e.uid){this._currentUser._assign(e),yield this.currentUser.getIdToken();return}yield this._updateCurrentUser(e,!0)}})}initializeCurrentUserFromIdToken(e){return _(this,null,function*(){try{let t=yield En(this,{idToken:e}),i=yield Pe._fromGetAccountInfoResponse(this,t,e);yield this.directlySetCurrentUser(i)}catch(t){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",t),yield this.directlySetCurrentUser(null)}})}initializeCurrentUser(e){return _(this,null,function*(){var t;if(ue(this.app)){let o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}let i=yield this.assertedPersistence.getCurrentUser(),r=i,s=!1;if(e&&this.config.authDomain){yield this.getOrInitRedirectPersistenceManager();let o=(t=this.redirectUser)===null||t===void 0?void 0:t._redirectEventId,a=r?._redirectEventId,c=yield this.tryRedirectSignIn(e);(!o||o===a)&&c?.user&&(r=c.user,s=!0)}if(!r)return this.directlySetCurrentUser(null);if(!r._redirectEventId){if(s)try{yield this.beforeStateQueue.runMiddleware(r)}catch(o){r=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return r?this.reloadAndSetCurrentUserOrClear(r):this.directlySetCurrentUser(null)}return T(this._popupRedirectResolver,this,"argument-error"),yield this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===r._redirectEventId?this.directlySetCurrentUser(r):this.reloadAndSetCurrentUserOrClear(r)})}tryRedirectSignIn(e){return _(this,null,function*(){let t=null;try{t=yield this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch{yield this._setRedirectUser(null)}return t})}reloadAndSetCurrentUserOrClear(e){return _(this,null,function*(){try{yield wn(e)}catch(t){if(t?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)})}useDeviceLanguage(){this.languageCode=Yu()}_delete(){return _(this,null,function*(){this._deleted=!0})}updateCurrentUser(e){return _(this,null,function*(){if(ue(this.app))return Promise.reject(gn(this));let t=e?x(e):null;return t&&T(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))})}_updateCurrentUser(e,t=!1){return _(this,null,function*(){if(!this._deleted)return e&&T(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||(yield this.beforeStateQueue.runMiddleware(e)),this.queue(()=>_(this,null,function*(){yield this.directlySetCurrentUser(e),this.notifyAuthListeners()}))})}signOut(){return _(this,null,function*(){return ue(this.app)?Promise.reject(gn(this)):(yield this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&(yield this._setRedirectUser(null)),this._updateCurrentUser(null,!0))})}setPersistence(e){return ue(this.app)?Promise.reject(gn(this)):this.queue(()=>_(this,null,function*(){yield this.assertedPersistence.setPersistence(Ne(e))}))}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}validatePassword(e){return _(this,null,function*(){this._getPasswordPolicyInternal()||(yield this._updatePasswordPolicy());let t=this._getPasswordPolicyInternal();return t.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):t.validatePassword(e)})}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}_updatePasswordPolicy(){return _(this,null,function*(){let e=yield fd(this),t=new Zi(e);this.tenantId===null?this._projectPasswordPolicy=t:this._tenantPasswordPolicies[this.tenantId]=t})}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(e){this._errorFactory=new q("auth","Firebase",e())}onAuthStateChanged(e,t,i){return this.registerStateListener(this.authStateSubscription,e,t,i)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,i){return this.registerStateListener(this.idTokenSubscription,e,t,i)}authStateReady(){return new Promise((e,t)=>{if(this.currentUser)e();else{let i=this.onAuthStateChanged(()=>{i(),e()},t)}})}revokeAccessToken(e){return _(this,null,function*(){if(this.currentUser){let t=yield this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:e,idToken:t};this.tenantId!=null&&(i.tenantId=this.tenantId),yield rd(this,i)}})}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(e=this._currentUser)===null||e===void 0?void 0:e.toJSON()}}_setRedirectUser(e,t){return _(this,null,function*(){let i=yield this.getOrInitRedirectPersistenceManager(t);return e===null?i.removeCurrentUser():i.setCurrentUser(e)})}getOrInitRedirectPersistenceManager(e){return _(this,null,function*(){if(!this.redirectPersistenceManager){let t=e&&Ne(e)||this._popupRedirectResolver;T(t,this,"argument-error"),this.redirectPersistenceManager=yield Tn.create(this,[Ne(t._redirectPersistence)],"redirectUser"),this.redirectUser=yield this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager})}_redirectUserForId(e){return _(this,null,function*(){var t,i;return this._isInitialized&&(yield this.queue(()=>_(this,null,function*(){}))),((t=this._currentUser)===null||t===void 0?void 0:t._redirectEventId)===e?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===e?this.redirectUser:null})}_persistUserIfCurrent(e){return _(this,null,function*(){if(e===this.currentUser)return this.queue(()=>_(this,null,function*(){return this.directlySetCurrentUser(e)}))})}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);let i=(t=(e=this.currentUser)===null||e===void 0?void 0:e.uid)!==null&&t!==void 0?t:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,i,r){if(this._deleted)return()=>{};let s=typeof t=="function"?t:t.next.bind(t),o=!1,a=this._isInitialized?Promise.resolve():this._initializationPromise;if(T(a,this,"internal-error"),a.then(()=>{o||s(this.currentUser)}),typeof t=="function"){let c=e.addObserver(t,i,r);return()=>{o=!0,c()}}else{let c=e.addObserver(t);return()=>{o=!0,c()}}}directlySetCurrentUser(e){return _(this,null,function*(){this.currentUser&&this.currentUser!==e&&this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh(),this.currentUser=e,e?yield this.assertedPersistence.setCurrentUser(e):yield this.assertedPersistence.removeCurrentUser()})}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return T(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){!e||this.frameworks.includes(e)||(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=Yo(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}_getAdditionalHeaders(){return _(this,null,function*(){var e;let t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);let i=yield(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getHeartbeatsHeader();i&&(t["X-Firebase-Client"]=i);let r=yield this._getAppCheckToken();return r&&(t["X-Firebase-AppCheck"]=r),t})}_getAppCheckToken(){return _(this,null,function*(){var e;if(ue(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;let t=yield(e=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||e===void 0?void 0:e.getToken();return t?.error&&qu(`Error while retrieving App Check token: ${t.error}`),t?.token})}};function _d(n){return x(n)}var Cn=class{constructor(e){this.auth=e,this.observer=null,this.addObserver=io(t=>this.observer=t)}get next(){return T(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}};var md={loadJS(){return _(this,null,function*(){throw new Error("Unable to load external scripts")})},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function gd(n){md=n}function vd(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function yd(n,e){let t=e?.persistence||[],i=(Array.isArray(t)?t:[t]).map(Ne);e?.errorMap&&n._updateErrorMap(e.errorMap),n._initializeWithPersistence(i,e?.popupRedirectResolver)}var Vm=vd("rcb"),Bm=new Oe(3e4,6e4);var Hm=new Oe(2e3,1e4);var $m=600*1e3;var jm=new Oe(3e4,6e4);var zm=new Oe(5e3,15e3);var qm=encodeURIComponent("fac");var Uo="@firebase/auth",Wo="1.10.8";var tr=class{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),((e=this.auth.currentUser)===null||e===void 0?void 0:e.uid)||null}getToken(e){return _(this,null,function*(){return this.assertAuthConfigured(),yield this.auth._initializationPromise,this.auth.currentUser?{accessToken:yield this.auth.currentUser.getIdToken(e)}:null})}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;let t=this.auth.onIdTokenChanged(i=>{e(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();let t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){T(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}};function Id(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ed(n){K(new L("auth",(e,{options:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("heartbeat"),s=e.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;T(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});let c={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Yo(n)},l=new er(i,r,s,c);return yd(l,t),l},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((e,t,i)=>{e.getProvider("auth-internal").initialize()})),K(new L("auth-internal",e=>{let t=_d(e.getProvider("auth").getImmediate());return(i=>new tr(i))(t)},"PRIVATE").setInstantiationMode("EXPLICIT")),R(Uo,Wo,Id(n)),R(Uo,Wo,"esm2017")}var wd=300,Gm=Ys("authIdTokenMaxAge")||wd;function Td(){var n,e;return(e=(n=document.getElementsByTagName("head"))===null||n===void 0?void 0:n[0])!==null&&e!==void 0?e:document}gd({loadJS(n){return new Promise((e,t)=>{let i=document.createElement("script");i.setAttribute("src",n),i.onload=e,i.onerror=r=>{let s=nr("internal-error");s.customData=r,t(s)},i.type="text/javascript",i.charset="UTF-8",Td().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});Ed("Browser");var Eh="auth";var Sn=class{constructor(){return Ye(Eh)}};var Jo="@firebase/database",Qo="1.0.20";var os="";function wh(n){os=n}var fr=class{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){t==null?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),P(t))}get(e){let t=this.domStorage_.getItem(this.prefixedName_(e));return t==null?null:je(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}};var pr=class{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){t==null?delete this.cache_[e]:this.cache_[e]=t}get(e){return te(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}};var Pa=function(n){try{if(typeof window<"u"&&typeof window[n]<"u"){let e=window[n];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new fr(e)}}catch{}return new pr},Le=Pa("localStorage"),_r=Pa("sessionStorage");var Xe=new ne("@firebase/database"),Th=(function(){let n=1;return function(){return n++}})(),Na=function(n){let e=ro(n),t=new tn;t.update(e);let i=t.digest();return ze.encodeByteArray(i)},jt=function(...n){let e="";for(let t=0;t<n.length;t++){let i=n[t];Array.isArray(i)||i&&typeof i=="object"&&typeof i.length=="number"?e+=jt.apply(null,i):typeof i=="object"?e+=P(i):e+=i,e+=" "}return e},xe=null,Xo=!0,Ch=function(n,e){p(!e||n===!0||n===!1,"Can't turn on custom loggers persistently."),n===!0?(Xe.logLevel=C.VERBOSE,xe=Xe.log.bind(Xe),e&&_r.set("logging_enabled",!0)):typeof n=="function"?xe=n:(xe=null,_r.remove("logging_enabled"))},D=function(...n){if(Xo===!0&&(Xo=!1,xe===null&&_r.get("logging_enabled")===!0&&Ch(!0)),xe){let e=jt.apply(null,n);xe(e)}},zt=function(n){return function(...e){D(n,...e)}},mr=function(...n){let e="FIREBASE INTERNAL ERROR: "+jt(...n);Xe.error(e)},de=function(...n){let e=`FIREBASE FATAL ERROR: ${jt(...n)}`;throw Xe.error(e),new Error(e)},F=function(...n){let e="FIREBASE WARNING: "+jt(...n);Xe.warn(e)},bh=function(){typeof window<"u"&&window.location&&window.location.protocol&&window.location.protocol.indexOf("https:")!==-1&&F("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().")},Oa=function(n){return typeof n=="number"&&(n!==n||n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY)},Sh=function(n){if(ee()||document.readyState==="complete")n();else{let e=!1,t=function(){if(!document.body){setTimeout(t,Math.floor(10));return}e||(e=!0,n())};document.addEventListener?(document.addEventListener("DOMContentLoaded",t,!1),window.addEventListener("load",t,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",()=>{document.readyState==="complete"&&t()}),window.attachEvent("onload",t))}},et="[MIN_NAME]",Fe="[MAX_NAME]",at=function(n,e){if(n===e)return 0;if(n===et||e===Fe)return-1;if(e===et||n===Fe)return 1;{let t=Zo(n),i=Zo(e);return t!==null?i!==null?t-i===0?n.length-e.length:t-i:-1:i!==null?1:n<e?-1:1}},Ah=function(n,e){return n===e?0:n<e?-1:1},At=function(n,e){if(e&&n in e)return e[n];throw new Error("Missing required key ("+n+") in object: "+P(e))},as=function(n){if(typeof n!="object"||n===null)return P(n);let e=[];for(let i in n)e.push(i);e.sort();let t="{";for(let i=0;i<e.length;i++)i!==0&&(t+=","),t+=P(e[i]),t+=":",t+=as(n[e[i]]);return t+="}",t},Da=function(n,e){let t=n.length;if(t<=e)return[n];let i=[];for(let r=0;r<t;r+=e)r+e>t?i.push(n.substring(r,t)):i.push(n.substring(r,r+e));return i};function U(n,e){for(let t in n)n.hasOwnProperty(t)&&e(t,n[t])}var La=function(n){p(!Oa(n),"Invalid JSON number");let e=11,t=52,i=(1<<e-1)-1,r,s,o,a,c;n===0?(s=0,o=0,r=1/n===-1/0?1:0):(r=n<0,n=Math.abs(n),n>=Math.pow(2,1-i)?(a=Math.min(Math.floor(Math.log(n)/Math.LN2),i),s=a+i,o=Math.round(n*Math.pow(2,t-a)-Math.pow(2,t))):(s=0,o=Math.round(n/Math.pow(2,1-i-t))));let l=[];for(c=t;c;c-=1)l.push(o%2?1:0),o=Math.floor(o/2);for(c=e;c;c-=1)l.push(s%2?1:0),s=Math.floor(s/2);l.push(r?1:0),l.reverse();let h=l.join(""),d="";for(c=0;c<64;c+=8){let u=parseInt(h.substr(c,8),2).toString(16);u.length===1&&(u="0"+u),d=d+u}return d.toLowerCase()},kh=function(){return!!(typeof window=="object"&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href))},Rh=function(){return typeof Windows=="object"&&typeof Windows.UI=="object"};function Ph(n,e){let t="Unknown Error";n==="too_big"?t="The data requested exceeds the maximum size that can be accessed with a single request.":n==="permission_denied"?t="Client doesn't have permission to access the desired data.":n==="unavailable"&&(t="The service is unavailable");let i=new Error(n+" at "+e._path.toString()+": "+t);return i.code=n.toUpperCase(),i}var Nh=new RegExp("^-?(0*)\\d{1,10}$"),Oh=-2147483648,Dh=2147483647,Zo=function(n){if(Nh.test(n)){let e=Number(n);if(e>=Oh&&e<=Dh)return e}return null},ct=function(n){try{n()}catch(e){setTimeout(()=>{let t=e.stack||"";throw F("Exception was thrown by user callback.",t),e},Math.floor(0))}},Lh=function(){return(typeof window=="object"&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Ot=function(n,e){let t=setTimeout(n,e);return typeof t=="number"&&typeof Deno<"u"&&Deno.unrefTimer?Deno.unrefTimer(t):typeof t=="object"&&t.unref&&t.unref(),t};var gr=class{constructor(e,t){this.appCheckProvider=t,this.appName=e.name,ue(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.appCheck=t?.getImmediate({optional:!0}),this.appCheck||t?.get().then(i=>this.appCheck=i)}getToken(e){if(this.serverAppAppCheckToken){if(e)throw new Error("Attempted reuse of `FirebaseServerApp.appCheckToken` after previous usage failed.");return Promise.resolve({token:this.serverAppAppCheckToken})}return this.appCheck?this.appCheck.getToken(e):new Promise((t,i)=>{setTimeout(()=>{this.appCheck?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){var t;(t=this.appCheckProvider)===null||t===void 0||t.get().then(i=>i.addTokenListener(e))}notifyForInvalidToken(){F(`Provided AppCheck credentials for the app named "${this.appName}" are invalid. This usually indicates your app was not initialized correctly.`)}};var vr=class{constructor(e,t,i){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=i,this.auth_=null,this.auth_=i.getImmediate({optional:!0}),this.auth_||i.onInit(r=>this.auth_=r)}getToken(e){return this.auth_?this.auth_.getToken(e).catch(t=>t&&t.code==="auth/token-not-initialized"?(D("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)):new Promise((t,i)=>{setTimeout(()=>{this.auth_?this.getToken(e).then(t,i):t(null)},0)})}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then(t=>t.addAuthTokenListener(e))}removeTokenChangeListener(e){this.authProvider_.get().then(t=>t.removeAuthTokenListener(e))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',F(e)}},Dt=(()=>{class n{constructor(t){this.accessToken=t}getToken(t){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(t){t(this.accessToken)}removeTokenChangeListener(t){}notifyForInvalidToken(){}}n.OWNER="owner";return n})(),kn="5",Ma="v",xa="s",Fa="r",Ua="f",Wa=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Va="ls",Ba="p",yr="ac",Ha="websocket",$a="long_polling";var Rn=class{constructor(e,t,i,r,s=!1,o="",a=!1,c=!1,l=null){this.secure=t,this.namespace=i,this.webSocketOnly=r,this.nodeAdmin=s,this.persistenceKey=o,this.includeNamespaceInQueryParams=a,this.isUsingEmulator=c,this.emulatorOptions=l,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Le.get("host:"+e)||this._host}isCacheableHost(){return this.internalHost.substr(0,2)==="s-"}isCustomHost(){return this._domain!=="firebaseio.com"&&this._domain!=="firebaseio-demo.com"}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Le.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){let e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}};function Mh(n){return n.host!==n.internalHost||n.isCustomHost()||n.includeNamespaceInQueryParams}function ja(n,e,t){p(typeof e=="string","typeof type must == string"),p(typeof t=="object","typeof params must == object");let i;if(e===Ha)i=(n.secure?"wss://":"ws://")+n.internalHost+"/.ws?";else if(e===$a)i=(n.secure?"https://":"http://")+n.internalHost+"/.lp?";else throw new Error("Unknown connection type: "+e);Mh(n)&&(t.ns=n.namespace);let r=[];return U(t,(s,o)=>{r.push(s+"="+o)}),i+r.join("&")}var Ir=class{constructor(){this.counters_={}}incrementCounter(e,t=1){te(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return js(this.counters_)}};var or={},ar={};function cs(n){let e=n.toString();return or[e]||(or[e]=new Ir),or[e]}function xh(n,e){let t=n.toString();return ar[t]||(ar[t]=e()),ar[t]}var Er=class{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){let i=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let r=0;r<i.length;++r)i[r]&&ct(()=>{this.onMessage_(i[r])});if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}};var ea="start",Fh="close",Uh="pLPCommand",Wh="pRTLPCB",za="id",qa="pw",Ga="ser",Vh="cb",Bh="seg",Hh="ts",$h="d",jh="dframe",Ka=1870,Ya=30,zh=Ka-Ya,qh=25e3,Gh=3e4,wr=class n{constructor(e,t,i,r,s,o,a){this.connId=e,this.repoInfo=t,this.applicationId=i,this.appCheckToken=r,this.authToken=s,this.transportSessionId=o,this.lastSessionId=a,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=zt(e),this.stats_=cs(t),this.urlFn=c=>(this.appCheckToken&&(c[yr]=this.appCheckToken),ja(t,$a,c))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Er(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null},Math.floor(Gh)),Sh(()=>{if(this.isClosed_)return;this.scriptTagHolder=new Tr((...s)=>{let[o,a,c,l,h]=s;if(this.incrementIncomingBytes_(s),!!this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,o===ea)this.id=a,this.password=c;else if(o===Fh)a?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(a,()=>{this.onClosed_()})):this.onClosed_();else throw new Error("Unrecognized command received: "+o)},(...s)=>{let[o,a]=s;this.incrementIncomingBytes_(s),this.myPacketOrderer.handleResponse(o,a)},()=>{this.onClosed_()},this.urlFn);let i={};i[ea]="t",i[Ga]=Math.floor(Math.random()*1e8),this.scriptTagHolder.uniqueCallbackIdentifier&&(i[Vh]=this.scriptTagHolder.uniqueCallbackIdentifier),i[Ma]=kn,this.transportSessionId&&(i[xa]=this.transportSessionId),this.lastSessionId&&(i[Va]=this.lastSessionId),this.applicationId&&(i[Ba]=this.applicationId),this.appCheckToken&&(i[yr]=this.appCheckToken),typeof location<"u"&&location.hostname&&Wa.test(location.hostname)&&(i[Fa]=Ua);let r=this.urlFn(i);this.log_("Connecting via long-poll to "+r),this.scriptTagHolder.addTag(r,()=>{})})}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){n.forceAllow_=!0}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){return ee()?!1:n.forceAllow_?!0:!n.forceDisallow_&&typeof document<"u"&&document.createElement!=null&&!kh()&&!Rh()}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){let t=P(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);let i=Ii(t),r=Da(i,zh);for(let s=0;s<r.length;s++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[s]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(ee())return;this.myDisconnFrame=document.createElement("iframe");let i={};i[jh]="t",i[za]=e,i[qa]=t,this.myDisconnFrame.src=this.urlFn(i),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){let t=P(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}},Tr=class n{constructor(e,t,i,r){if(this.onDisconnect=i,this.urlFn=r,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(Math.random()*1e8),this.sendNewPolls=!0,ee())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Th(),window[Uh+this.uniqueCallbackIdentifier]=e,window[Wh+this.uniqueCallbackIdentifier]=t,this.myIFrame=n.createIFrame_();let s="";this.myIFrame.src&&this.myIFrame.src.substr(0,11)==="javascript:"&&(s='<script>document.domain="'+document.domain+'";<\/script>');let o="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(o),this.myIFrame.doc.close()}catch(a){D("frame writing exception"),a.stack&&D(a.stack),D(a)}}}static createIFrame_(){let e=document.createElement("iframe");if(e.style.display="none",document.body){document.body.appendChild(e);try{e.contentWindow.document||D("No IE domain setting required")}catch{let i=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+i+"';document.close();})())"}}else throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.textContent="",setTimeout(()=>{this.myIFrame!==null&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)},Math.floor(0)));let e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;let e={};e[za]=this.myID,e[qa]=this.myPW,e[Ga]=this.currentSerial;let t=this.urlFn(e),i="",r=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+Ya+i.length<=Ka;){let o=this.pendingSegs.shift();i=i+"&"+Bh+r+"="+o.seg+"&"+Hh+r+"="+o.ts+"&"+$h+r+"="+o.d,r++}return t=t+i,this.addLongPollTag_(t,this.currentSerial),!0}else return!1}enqueueSegment(e,t,i){this.pendingSegs.push({seg:e,ts:t,d:i}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);let i=()=>{this.outstandingRequests.delete(t),this.newRequest_()},r=setTimeout(i,Math.floor(qh)),s=()=>{clearTimeout(r),i()};this.addTag(e,s)}addTag(e,t){ee()?this.doNodeLongPoll(e,t):setTimeout(()=>{try{if(!this.sendNewPolls)return;let i=this.myIFrame.doc.createElement("script");i.type="text/javascript",i.async=!0,i.src=e,i.onload=i.onreadystatechange=function(){let r=i.readyState;(!r||r==="loaded"||r==="complete")&&(i.onload=i.onreadystatechange=null,i.parentNode&&i.parentNode.removeChild(i),t())},i.onerror=()=>{D("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(i)}catch{}},Math.floor(1))}};var Kh=16384,Yh=45e3,Pn=null;typeof MozWebSocket<"u"?Pn=MozWebSocket:typeof WebSocket<"u"&&(Pn=WebSocket);var kt=(()=>{class n{constructor(t,i,r,s,o,a,c){this.connId=t,this.applicationId=r,this.appCheckToken=s,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=zt(this.connId),this.stats_=cs(i),this.connURL=n.connectionURL_(i,a,c,s,r),this.nodeAdmin=i.nodeAdmin}static connectionURL_(t,i,r,s,o){let a={};return a[Ma]=kn,!ee()&&typeof location<"u"&&location.hostname&&Wa.test(location.hostname)&&(a[Fa]=Ua),i&&(a[xa]=i),r&&(a[Va]=r),s&&(a[yr]=s),o&&(a[Ba]=o),ja(t,Ha,a)}open(t,i){this.onDisconnect=i,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Le.set("previous_websocket_failure",!0);try{let r;if(ee()){let s=this.nodeAdmin?"AdminNode":"Node";r={headers:{"User-Agent":`Firebase/${kn}/${os}/${process.platform}/${s}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(r.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);let o=process.env,a=this.connURL.indexOf("wss://")===0?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;a&&(r.proxy={origin:a})}this.mySock=new Pn(this.connURL,[],r)}catch(r){this.log_("Error instantiating WebSocket.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_();return}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=r=>{this.handleIncomingFrame(r)},this.mySock.onerror=r=>{this.log_("WebSocket error.  Closing connection.");let s=r.message||r.data;s&&this.log_(s),this.onClosed_()}}start(){}static forceDisallow(){n.forceDisallow_=!0}static isAvailable(){let t=!1;if(typeof navigator<"u"&&navigator.userAgent){let i=/Android ([0-9]{0,}\.[0-9]{0,})/,r=navigator.userAgent.match(i);r&&r.length>1&&parseFloat(r[1])<4.4&&(t=!0)}return!t&&Pn!==null&&!n.forceDisallow_}static previouslyFailed(){return Le.isInMemoryStorage||Le.get("previous_websocket_failure")===!0}markConnectionHealthy(){Le.remove("previous_websocket_failure")}appendFrame_(t){if(this.frames.push(t),this.frames.length===this.totalFrames){let i=this.frames.join("");this.frames=null;let r=je(i);this.onMessage(r)}}handleNewFrameCount_(t){this.totalFrames=t,this.frames=[]}extractFrameCount_(t){if(p(this.frames===null,"We already have a frame buffer"),t.length<=6){let i=Number(t);if(!isNaN(i))return this.handleNewFrameCount_(i),null}return this.handleNewFrameCount_(1),t}handleIncomingFrame(t){if(this.mySock===null)return;let i=t.data;if(this.bytesReceived+=i.length,this.stats_.incrementCounter("bytes_received",i.length),this.resetKeepAlive(),this.frames!==null)this.appendFrame_(i);else{let r=this.extractFrameCount_(i);r!==null&&this.appendFrame_(r)}}send(t){this.resetKeepAlive();let i=P(t);this.bytesSent+=i.length,this.stats_.incrementCounter("bytes_sent",i.length);let r=Da(i,Kh);r.length>1&&this.sendString_(String(r.length));for(let s=0;s<r.length;s++)this.sendString_(r[s])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()},Math.floor(Yh))}sendString_(t){try{this.mySock.send(t)}catch(i){this.log_("Exception thrown from WebSocket.send():",i.message||i.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}n.responsesRequiredToBeHealthy=2,n.healthyTimeout=3e4;return n})(),Jh=(()=>{class n{static get ALL_TRANSPORTS(){return[wr,kt]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}constructor(t){this.initTransports_(t)}initTransports_(t){let i=kt&&kt.isAvailable(),r=i&&!kt.previouslyFailed();if(t.webSocketOnly&&(i||F("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),r=!0),r)this.transports_=[kt];else{let s=this.transports_=[];for(let o of n.ALL_TRANSPORTS)o&&o.isAvailable()&&s.push(o);n.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}n.globalTransportInitialized_=!1;return n})(),Qh=6e4,Xh=5e3,Zh=10*1024,ef=100*1024,cr="t",ta="d",tf="s",na="r",nf="e",ia="o",ra="a",sa="n",oa="p",rf="h",Cr=class{constructor(e,t,i,r,s,o,a,c,l,h){this.id=e,this.repoInfo_=t,this.applicationId_=i,this.appCheckToken_=r,this.authToken_=s,this.onMessage_=o,this.onReady_=a,this.onDisconnect_=c,this.onKill_=l,this.lastSessionId=h,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=zt("c:"+this.id+":"),this.transportManager_=new Jh(t),this.log_("Connection created"),this.start_()}start_(){let e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.conn_),i=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(()=>{this.conn_&&this.conn_.open(t,i)},Math.floor(0));let r=e.healthyTimeout||0;r>0&&(this.healthyTimeout_=Ot(()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>ef?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>Zh?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))},Math.floor(r)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{this.state_!==2&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){let t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if(cr in e){let t=e[cr];t===ra?this.upgradeIfSecondaryHealthy_():t===na?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),(this.tx_===this.secondaryConn_||this.rx_===this.secondaryConn_)&&this.close()):t===ia&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){let t=At("t",e),i=At("d",e);if(t==="c")this.onSecondaryControl_(i);else if(t==="d")this.pendingDataMessages.push(i);else throw new Error("Unknown protocol layer: "+t)}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:oa,d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:ra,d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:sa,d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){let t=At("t",e),i=At("d",e);t==="c"?this.onControl_(i):t==="d"&&this.onDataMessage_(i)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){let t=At(cr,e);if(ta in e){let i=e[ta];if(t===rf){let r=Object.assign({},i);this.repoInfo_.isUsingEmulator&&(r.h=this.repoInfo_.host),this.onHandshake_(r)}else if(t===sa){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else t===tf?this.onConnectionShutdown_(i):t===na?this.onReset_(i):t===nf?mr("Server Error: "+i):t===ia?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):mr("Unknown control packet command: "+t)}}onHandshake_(e){let t=e.ts,i=e.v,r=e.h;this.sessionId=e.s,this.repoInfo_.host=r,this.state_===0&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),kn!==i&&F("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){let e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;let t=this.connReceiver_(this.secondaryConn_),i=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,i),Ot(()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())},Math.floor(Qh))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,this.state_===1?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),this.primaryResponsesRequired_===0?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Ot(()=>{this.sendPingOnPrimaryIfNecessary_()},Math.floor(Xh))}sendPingOnPrimaryIfNecessary_(){!this.isHealthy_&&this.state_===1&&(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:oa,d:{}}}))}onSecondaryConnectionLost_(){let e=this.secondaryConn_;this.secondaryConn_=null,(this.tx_===e||this.rx_===e)&&this.close()}onConnectionLost_(e){this.conn_=null,!e&&this.state_===0?(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Le.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)):this.state_===1&&this.log_("Realtime connection lost."),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(this.state_!==1)throw"Connection is not connected";this.tx_.send(e)}close(){this.state_!==2&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}};var Nn=class{put(e,t,i,r){}merge(e,t,i,r){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,i){}onDisconnectMerge(e,t,i){}onDisconnectCancel(e,t){}reportStats(e){}};var On=class{constructor(e){this.allowedEvents_=e,this.listeners_={},p(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){let i=[...this.listeners_[e]];for(let r=0;r<i.length;r++)i[r].callback.apply(i[r].context,t)}}on(e,t,i){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:i});let r=this.getInitialEvent(e);r&&t.apply(i,r)}off(e,t,i){this.validateEventType_(e);let r=this.listeners_[e]||[];for(let s=0;s<r.length;s++)if(r[s].callback===t&&(!i||i===r[s].context)){r.splice(s,1);return}}validateEventType_(e){p(this.allowedEvents_.find(t=>t===e),"Unknown event: "+e)}};var Dn=class n extends On{static getInstance(){return new n}constructor(){super(["online"]),this.online_=!0,typeof window<"u"&&typeof window.addEventListener<"u"&&!ft()&&(window.addEventListener("online",()=>{this.online_||(this.online_=!0,this.trigger("online",!0))},!1),window.addEventListener("offline",()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))},!1))}getInitialEvent(e){return p(e==="online","Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}};var aa=32,ca=768,b=class{constructor(e,t){if(t===void 0){this.pieces_=e.split("/");let i=0;for(let r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[i]=this.pieces_[r],i++);this.pieces_.length=i,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)this.pieces_[t]!==""&&(e+="/"+this.pieces_[t]);return e||"/"}};function w(){return new b("")}function v(n){return n.pieceNum_>=n.pieces_.length?null:n.pieces_[n.pieceNum_]}function ye(n){return n.pieces_.length-n.pieceNum_}function S(n){let e=n.pieceNum_;return e<n.pieces_.length&&e++,new b(n.pieces_,e)}function Ja(n){return n.pieceNum_<n.pieces_.length?n.pieces_[n.pieces_.length-1]:null}function sf(n){let e="";for(let t=n.pieceNum_;t<n.pieces_.length;t++)n.pieces_[t]!==""&&(e+="/"+encodeURIComponent(String(n.pieces_[t])));return e||"/"}function Qa(n,e=0){return n.pieces_.slice(n.pieceNum_+e)}function Xa(n){if(n.pieceNum_>=n.pieces_.length)return null;let e=[];for(let t=n.pieceNum_;t<n.pieces_.length-1;t++)e.push(n.pieces_[t]);return new b(e,0)}function N(n,e){let t=[];for(let i=n.pieceNum_;i<n.pieces_.length;i++)t.push(n.pieces_[i]);if(e instanceof b)for(let i=e.pieceNum_;i<e.pieces_.length;i++)t.push(e.pieces_[i]);else{let i=e.split("/");for(let r=0;r<i.length;r++)i[r].length>0&&t.push(i[r])}return new b(t,0)}function I(n){return n.pieceNum_>=n.pieces_.length}function M(n,e){let t=v(n),i=v(e);if(t===null)return e;if(t===i)return M(S(n),S(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+n+")")}function ls(n,e){if(ye(n)!==ye(e))return!1;for(let t=n.pieceNum_,i=e.pieceNum_;t<=n.pieces_.length;t++,i++)if(n.pieces_[t]!==e.pieces_[i])return!1;return!0}function Q(n,e){let t=n.pieceNum_,i=e.pieceNum_;if(ye(n)>ye(e))return!1;for(;t<n.pieces_.length;){if(n.pieces_[t]!==e.pieces_[i])return!1;++t,++i}return!0}var br=class{constructor(e,t){this.errorPrefix_=t,this.parts_=Qa(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let i=0;i<this.parts_.length;i++)this.byteLength_+=mt(this.parts_[i]);Za(this)}};function of(n,e){n.parts_.length>0&&(n.byteLength_+=1),n.parts_.push(e),n.byteLength_+=mt(e),Za(n)}function af(n){let e=n.parts_.pop();n.byteLength_-=mt(e),n.parts_.length>0&&(n.byteLength_-=1)}function Za(n){if(n.byteLength_>ca)throw new Error(n.errorPrefix_+"has a key path longer than "+ca+" bytes ("+n.byteLength_+").");if(n.parts_.length>aa)throw new Error(n.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+aa+") or object contains a cycle "+De(n))}function De(n){return n.parts_.length===0?"":"in property '"+n.parts_.join(".")+"'"}var Sr=class n extends On{static getInstance(){return new n}constructor(){super(["visible"]);let e,t;typeof document<"u"&&typeof document.addEventListener<"u"&&(typeof document.hidden<"u"?(t="visibilitychange",e="hidden"):typeof document.mozHidden<"u"?(t="mozvisibilitychange",e="mozHidden"):typeof document.msHidden<"u"?(t="msvisibilitychange",e="msHidden"):typeof document.webkitHidden<"u"&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,()=>{let i=!document[e];i!==this.visible_&&(this.visible_=i,this.trigger("visible",i))},!1)}getInitialEvent(e){return p(e==="visible","Unknown event type: "+e),[this.visible_]}};var Rt=1e3,cf=300*1e3,la=30*1e3,lf=1.3,uf=3e4,df="server_kill",ua=3,us=(()=>{class n extends Nn{constructor(t,i,r,s,o,a,c,l){if(super(),this.repoInfo_=t,this.applicationId_=i,this.onDataUpdate_=r,this.onConnectStatus_=s,this.onServerInfoUpdate_=o,this.authTokenProvider_=a,this.appCheckTokenProvider_=c,this.authOverride_=l,this.id=n.nextPersistentConnectionId_++,this.log_=zt("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=Rt,this.maxReconnectDelay_=cf,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,l&&!ee())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");Sr.getInstance().on("visible",this.onVisible_,this),t.host.indexOf("fblocal")===-1&&Dn.getInstance().on("online",this.onOnline_,this)}sendRequest(t,i,r){let s=++this.requestNumber_,o={r:s,a:t,b:i};this.log_(P(o)),p(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),r&&(this.requestCBHash_[s]=r)}get(t){this.initConnection_();let i=new z,s={action:"g",request:{p:t._path.toString(),q:t._queryObject},onComplete:a=>{let c=a.d;a.s==="ok"?i.resolve(c):i.reject(c)}};this.outstandingGets_.push(s),this.outstandingGetCount_++;let o=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(o),i.promise}listen(t,i,r,s){this.initConnection_();let o=t._queryIdentifier,a=t._path.toString();this.log_("Listen called for "+a+" "+o),this.listens.has(a)||this.listens.set(a,new Map),p(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),p(!this.listens.get(a).has(o),"listen() called twice for same path/queryId.");let c={onComplete:s,hashFn:i,query:t,tag:r};this.listens.get(a).set(o,c),this.connected_&&this.sendListen_(c)}sendGet_(t){let i=this.outstandingGets_[t];this.sendRequest("g",i.request,r=>{delete this.outstandingGets_[t],this.outstandingGetCount_--,this.outstandingGetCount_===0&&(this.outstandingGets_=[]),i.onComplete&&i.onComplete(r)})}sendListen_(t){let i=t.query,r=i._path.toString(),s=i._queryIdentifier;this.log_("Listen on "+r+" for "+s);let o={p:r},a="q";t.tag&&(o.q=i._queryObject,o.t=t.tag),o.h=t.hashFn(),this.sendRequest(a,o,c=>{let l=c.d,h=c.s;n.warnOnListenWarnings_(l,i),(this.listens.get(r)&&this.listens.get(r).get(s))===t&&(this.log_("listen response",c),h!=="ok"&&this.removeListen_(r,s),t.onComplete&&t.onComplete(h,l))})}static warnOnListenWarnings_(t,i){if(t&&typeof t=="object"&&te(t,"w")){let r=Te(t,"w");if(Array.isArray(r)&&~r.indexOf("no_index")){let s='".indexOn": "'+i._queryParams.getIndex().toString()+'"',o=i._path.toString();F(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${s} at ${o} to your security rules for better performance.`)}}}refreshAuthToken(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},()=>{}),this.reduceReconnectDelayIfAdminCredential_(t)}reduceReconnectDelayIfAdminCredential_(t){(t&&t.length===40||no(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=la)}refreshAppCheckToken(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},()=>{})}tryAuth(){if(this.connected_&&this.authToken_){let t=this.authToken_,i=to(t)?"auth":"gauth",r={cred:t};this.authOverride_===null?r.noauth=!0:typeof this.authOverride_=="object"&&(r.authvar=this.authOverride_),this.sendRequest(i,r,s=>{let o=s.s,a=s.d||"error";this.authToken_===t&&(o==="ok"?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(o,a))})}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},t=>{let i=t.s,r=t.d||"error";i==="ok"?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(i,r)})}unlisten(t,i){let r=t._path.toString(),s=t._queryIdentifier;this.log_("Unlisten called for "+r+" "+s),p(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(r,s)&&this.connected_&&this.sendUnlisten_(r,s,t._queryObject,i)}sendUnlisten_(t,i,r,s){this.log_("Unlisten on "+t+" for "+i);let o={p:t},a="n";s&&(o.q=r,o.t=s),this.sendRequest(a,o)}onDisconnectPut(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:i,onComplete:r})}onDisconnectMerge(t,i,r){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,i,r):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:i,onComplete:r})}onDisconnectCancel(t,i){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,i):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:i})}sendOnDisconnect_(t,i,r,s){let o={p:i,d:r};this.log_("onDisconnect "+t,o),this.sendRequest(t,o,a=>{s&&setTimeout(()=>{s(a.s,a.d)},Math.floor(0))})}put(t,i,r,s){this.putInternal("p",t,i,r,s)}merge(t,i,r,s){this.putInternal("m",t,i,r,s)}putInternal(t,i,r,s,o){this.initConnection_();let a={p:i,d:r};o!==void 0&&(a.h=o),this.outstandingPuts_.push({action:t,request:a,onComplete:s}),this.outstandingPutCount_++;let c=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(c):this.log_("Buffering put: "+i)}sendPut_(t){let i=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,s=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(i,r,o=>{this.log_(i+" response",o),delete this.outstandingPuts_[t],this.outstandingPutCount_--,this.outstandingPutCount_===0&&(this.outstandingPuts_=[]),s&&s(o.s,o.d)})}reportStats(t){if(this.connected_){let i={c:t};this.log_("reportStats",i),this.sendRequest("s",i,r=>{if(r.s!=="ok"){let o=r.d;this.log_("reportStats","Error sending stats: "+o)}})}}onDataMessage_(t){if("r"in t){this.log_("from server: "+P(t));let i=t.r,r=this.requestCBHash_[i];r&&(delete this.requestCBHash_[i],r(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}}onDataPush_(t,i){this.log_("handleServerMessage",t,i),t==="d"?this.onDataUpdate_(i.p,i.d,!1,i.t):t==="m"?this.onDataUpdate_(i.p,i.d,!0,i.t):t==="c"?this.onListenRevoked_(i.p,i.q):t==="ac"?this.onAuthRevoked_(i.s,i.d):t==="apc"?this.onAppCheckRevoked_(i.s,i.d):t==="sd"?this.onSecurityDebugPacket_(i):mr("Unrecognized action received from server: "+P(t)+`
Are you using the latest client?`)}onReady_(t,i){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=new Date().getTime(),this.handleTimestamp_(t),this.lastSessionId=i,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(t){p(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(()=>{this.establishConnectionTimer_=null,this.establishConnection_()},Math.floor(t))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0)),this.visible_=t}onOnline_(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&(new Date().getTime()-this.lastConnectionEstablishedTime_>uf&&(this.reconnectDelay_=Rt),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=new Date().getTime());let t=Math.max(0,new Date().getTime()-this.lastConnectionAttemptTime_),i=Math.max(0,this.reconnectDelay_-t);i=Math.random()*i,this.log_("Trying to reconnect in "+i+"ms"),this.scheduleConnect_(i),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,this.reconnectDelay_*lf)}this.onConnectStatus_(!1)}establishConnection_(){return _(this,null,function*(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=new Date().getTime(),this.lastConnectionEstablishedTime_=null;let t=this.onDataMessage_.bind(this),i=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+n.nextConnectionId_++,o=this.lastSessionId,a=!1,c=null,l=function(){c?c.close():(a=!0,r())},h=function(u){p(c,"sendRequest call when we're not connected not allowed."),c.sendRequest(u)};this.realtime_={close:l,sendRequest:h};let d=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{let[u,f]=yield Promise.all([this.authTokenProvider_.getToken(d),this.appCheckTokenProvider_.getToken(d)]);a?D("getToken() completed but was canceled"):(D("getToken() completed. Creating connection."),this.authToken_=u&&u.accessToken,this.appCheckToken_=f&&f.token,c=new Cr(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,i,r,m=>{F(m+" ("+this.repoInfo_.toString()+")"),this.interrupt(df)},o))}catch(u){this.log_("Failed to get token: "+u),a||(this.repoInfo_.nodeAdmin&&F(u),l())}}})}interrupt(t){D("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(t){D("Resuming connection for reason: "+t),delete this.interruptReasons_[t],sn(this.interruptReasons_)&&(this.reconnectDelay_=Rt,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(t){let i=t-new Date().getTime();this.onServerInfoUpdate_({serverTimeOffset:i})}cancelSentTransactions_(){for(let t=0;t<this.outstandingPuts_.length;t++){let i=this.outstandingPuts_[t];i&&"h"in i.request&&i.queued&&(i.onComplete&&i.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}this.outstandingPutCount_===0&&(this.outstandingPuts_=[])}onListenRevoked_(t,i){let r;i?r=i.map(o=>as(o)).join("$"):r="default";let s=this.removeListen_(t,r);s&&s.onComplete&&s.onComplete("permission_denied")}removeListen_(t,i){let r=new b(t).toString(),s;if(this.listens.has(r)){let o=this.listens.get(r);s=o.get(i),o.delete(i),o.size===0&&this.listens.delete(r)}else s=void 0;return s}onAuthRevoked_(t,i){D("Auth token revoked: "+t+"/"+i),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),(t==="invalid_token"||t==="permission_denied")&&(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=ua&&(this.reconnectDelay_=la,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(t,i){D("App check token revoked: "+t+"/"+i),this.appCheckToken_=null,this.forceTokenRefresh_=!0,(t==="invalid_token"||t==="permission_denied")&&(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=ua&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace(`
`,`
FIREBASE: `))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(let t of this.listens.values())for(let i of t.values())this.sendListen_(i);for(let t=0;t<this.outstandingPuts_.length;t++)this.outstandingPuts_[t]&&this.sendPut_(t);for(;this.onDisconnectRequestQueue_.length;){let t=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(t.action,t.pathString,t.data,t.onComplete)}for(let t=0;t<this.outstandingGets_.length;t++)this.outstandingGets_[t]&&this.sendGet_(t)}sendConnectStats_(){let t={},i="js";ee()&&(this.repoInfo_.nodeAdmin?i="admin_node":i="node"),t["sdk."+i+"."+os.replace(/\./g,"-")]=1,ft()?t["framework.cordova"]=1:nn()&&(t["framework.reactnative"]=1),this.reportStats(t)}shouldReconnect_(){let t=Dn.getInstance().currentlyOnline();return sn(this.interruptReasons_)&&t}}n.nextPersistentConnectionId_=0,n.nextConnectionId_=0;return n})(),y=class n{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new n(e,t)}};var tt=class{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){let i=new y(et,e),r=new y(et,t);return this.compare(i,r)!==0}minPost(){return y.MIN}};var An,Ln=class extends tt{static get __EMPTY_NODE(){return An}static set __EMPTY_NODE(e){An=e}compare(e,t){return at(e.name,t.name)}isDefinedOn(e){throw Ee("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return y.MIN}maxPost(){return new y(Fe,An)}makePost(e,t){return p(typeof e=="string","KeyIndex indexValue must always be a string."),new y(e,An)}toString(){return".key"}},Ze=new Ln;var Qe=class{constructor(e,t,i,r,s=null){this.isReverse_=r,this.resultGenerator_=s,this.nodeStack_=[];let o=1;for(;!e.isEmpty();)if(e=e,o=t?i(e.key,t):1,r&&(o*=-1),o<0)this.isReverse_?e=e.left:e=e.right;else if(o===0){this.nodeStack_.push(e);break}else this.nodeStack_.push(e),this.isReverse_?e=e.right:e=e.left}getNext(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_.pop(),t;if(this.resultGenerator_?t=this.resultGenerator_(e.key,e.value):t={key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t}hasNext(){return this.nodeStack_.length>0}peek(){if(this.nodeStack_.length===0)return null;let e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}},J=(()=>{class n{constructor(t,i,r,s,o){this.key=t,this.value=i,this.color=r??n.RED,this.left=s??$.EMPTY_NODE,this.right=o??$.EMPTY_NODE}copy(t,i,r,s,o){return new n(t??this.key,i??this.value,r??this.color,s??this.left,o??this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,i,r){let s=this,o=r(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,i,r),null):o===0?s=s.copy(null,i,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,i,r)),s.fixUp_()}removeMin_(){if(this.left.isEmpty())return $.EMPTY_NODE;let t=this;return!t.left.isRed_()&&!t.left.left.isRed_()&&(t=t.moveRedLeft_()),t=t.copy(null,null,null,t.left.removeMin_(),null),t.fixUp_()}remove(t,i){let r,s;if(r=this,i(t,r.key)<0)!r.left.isEmpty()&&!r.left.isRed_()&&!r.left.left.isRed_()&&(r=r.moveRedLeft_()),r=r.copy(null,null,null,r.left.remove(t,i),null);else{if(r.left.isRed_()&&(r=r.rotateRight_()),!r.right.isEmpty()&&!r.right.isRed_()&&!r.right.left.isRed_()&&(r=r.moveRedRight_()),i(t,r.key)===0){if(r.right.isEmpty())return $.EMPTY_NODE;s=r.right.min_(),r=r.copy(s.key,s.value,null,null,r.right.removeMin_())}r=r.copy(null,null,null,null,r.right.remove(t,i))}return r.fixUp_()}isRed_(){return this.color}fixUp_(){let t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t}moveRedLeft_(){let t=this.colorFlip_();return t.right.left.isRed_()&&(t=t.copy(null,null,null,null,t.right.rotateRight_()),t=t.rotateLeft_(),t=t.colorFlip_()),t}moveRedRight_(){let t=this.colorFlip_();return t.left.left.isRed_()&&(t=t.rotateRight_(),t=t.colorFlip_()),t}rotateLeft_(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight_(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip_(){let t=this.left.copy(null,null,!this.left.color,null,null),i=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,i)}checkMaxDepth_(){let t=this.check_();return Math.pow(2,t)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");let t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)}}return n.RED=!0,n.BLACK=!1,n})(),Ar=class{copy(e,t,i,r,s){return this}insert(e,t,i){return new J(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}},$=class n{constructor(e,t=n.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new n(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,J.BLACK,null,null))}remove(e){return new n(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,J.BLACK,null,null))}get(e){let t,i=this.root_;for(;!i.isEmpty();){if(t=this.comparator_(e,i.key),t===0)return i.value;t<0?i=i.left:t>0&&(i=i.right)}return null}getPredecessorKey(e){let t,i=this.root_,r=null;for(;!i.isEmpty();)if(t=this.comparator_(e,i.key),t===0){if(i.left.isEmpty())return r?r.key:null;for(i=i.left;!i.right.isEmpty();)i=i.right;return i.key}else t<0?i=i.left:t>0&&(r=i,i=i.right);throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new Qe(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new Qe(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new Qe(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new Qe(this.root_,null,this.comparator_,!0,e)}};$.EMPTY_NODE=new Ar;function hf(n,e){return at(n.name,e.name)}function ds(n,e){return at(n,e)}var kr;function ff(n){kr=n}var ec=function(n){return typeof n=="number"?"number:"+La(n):"string:"+n},tc=function(n){if(n.isLeafNode()){let e=n.val();p(typeof e=="string"||typeof e=="number"||typeof e=="object"&&te(e,".sv"),"Priority must be a string or number.")}else p(n===kr||n.isEmpty(),"priority of unexpected type.");p(n===kr||n.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};var da,nt=(()=>{class n{static set __childrenNodeConstructor(t){da=t}static get __childrenNodeConstructor(){return da}constructor(t,i=n.__childrenNodeConstructor.EMPTY_NODE){this.value_=t,this.priorityNode_=i,this.lazyHash_=null,p(this.value_!==void 0&&this.value_!==null,"LeafNode shouldn't be created with null/undefined value."),tc(this.priorityNode_)}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(t){return new n(this.value_,t)}getImmediateChild(t){return t===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}getChild(t){return I(t)?this:v(t)===".priority"?this.priorityNode_:n.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(t,i){return null}updateImmediateChild(t,i){return t===".priority"?this.updatePriority(i):i.isEmpty()&&t!==".priority"?this:n.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(t,i).updatePriority(this.priorityNode_)}updateChild(t,i){let r=v(t);return r===null?i:i.isEmpty()&&r!==".priority"?this:(p(r!==".priority"||ye(t)===1,".priority must be the last token in a path"),this.updateImmediateChild(r,n.__childrenNodeConstructor.EMPTY_NODE.updateChild(S(t),i)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(t,i){return!1}val(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(this.lazyHash_===null){let t="";this.priorityNode_.isEmpty()||(t+="priority:"+ec(this.priorityNode_.val())+":");let i=typeof this.value_;t+=i+":",i==="number"?t+=La(this.value_):t+=this.value_,this.lazyHash_=Na(t)}return this.lazyHash_}getValue(){return this.value_}compareTo(t){return t===n.__childrenNodeConstructor.EMPTY_NODE?1:t instanceof n.__childrenNodeConstructor?-1:(p(t.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(t))}compareToLeafNode_(t){let i=typeof t.value_,r=typeof this.value_,s=n.VALUE_TYPE_ORDER.indexOf(i),o=n.VALUE_TYPE_ORDER.indexOf(r);return p(s>=0,"Unknown leaf type: "+i),p(o>=0,"Unknown leaf type: "+r),s===o?r==="object"?0:this.value_<t.value_?-1:this.value_===t.value_?0:1:o-s}withIndex(){return this}isIndexed(){return!0}equals(t){if(t===this)return!0;if(t.isLeafNode()){let i=t;return this.value_===i.value_&&this.priorityNode_.equals(i.priorityNode_)}else return!1}}n.VALUE_TYPE_ORDER=["object","boolean","number","string"];return n})(),nc,ic;function pf(n){nc=n}function _f(n){ic=n}var Rr=class extends tt{compare(e,t){let i=e.node.getPriority(),r=t.node.getPriority(),s=i.compareTo(r);return s===0?at(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return y.MIN}maxPost(){return new y(Fe,new nt("[PRIORITY-POST]",ic))}makePost(e,t){let i=nc(e);return new y(t,new nt("[PRIORITY-POST]",i))}toString(){return".priority"}},k=new Rr;var mf=Math.log(2),Pr=class{constructor(e){let t=s=>parseInt(Math.log(s)/mf,10),i=s=>parseInt(Array(s+1).join("1"),2);this.count=t(e+1),this.current_=this.count-1;let r=i(this.count);this.bits_=e+1&r}nextBitIsOne(){let e=!(this.bits_&1<<this.current_);return this.current_--,e}},Mn=function(n,e,t,i){n.sort(e);let r=function(c,l){let h=l-c,d,u;if(h===0)return null;if(h===1)return d=n[c],u=t?t(d):d,new J(u,d.node,J.BLACK,null,null);{let f=parseInt(h/2,10)+c,m=r(c,f),E=r(f+1,l);return d=n[f],u=t?t(d):d,new J(u,d.node,J.BLACK,m,E)}},s=function(c){let l=null,h=null,d=n.length,u=function(m,E){let A=d-m,V=d;d-=m;let B=r(A+1,V),j=n[A],Be=t?t(j):j;f(new J(Be,j.node,E,null,B))},f=function(m){l?(l.left=m,l=m):(h=m,l=m)};for(let m=0;m<c.count;++m){let E=c.nextBitIsOne(),A=Math.pow(2,c.count-(m+1));E?u(A,J.BLACK):(u(A,J.BLACK),u(A,J.RED))}return h},o=new Pr(n.length),a=s(o);return new $(i||e,a)};var lr,Je={},it=class n{static get Default(){return p(Je&&k,"ChildrenNode.ts has not been loaded"),lr=lr||new n({".priority":Je},{".priority":k}),lr}constructor(e,t){this.indexes_=e,this.indexSet_=t}get(e){let t=Te(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof $?t:null}hasIndex(e){return te(this.indexSet_,e.toString())}addIndex(e,t){p(e!==Ze,"KeyIndex always exists and isn't meant to be added to the IndexMap.");let i=[],r=!1,s=t.getIterator(y.Wrap),o=s.getNext();for(;o;)r=r||e.isDefinedOn(o.node),i.push(o),o=s.getNext();let a;r?a=Mn(i,e.getCompare()):a=Je;let c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;let h=Object.assign({},this.indexes_);return h[c]=a,new n(h,l)}addToIndexes(e,t){let i=pt(this.indexes_,(r,s)=>{let o=Te(this.indexSet_,s);if(p(o,"Missing index implementation for "+s),r===Je)if(o.isDefinedOn(e.node)){let a=[],c=t.getIterator(y.Wrap),l=c.getNext();for(;l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),Mn(a,o.getCompare())}else return Je;else{let a=t.get(e.name),c=r;return a&&(c=c.remove(new y(e.name,a))),c.insert(e,e.node)}});return new n(i,this.indexSet_)}removeFromIndexes(e,t){let i=pt(this.indexes_,r=>{if(r===Je)return r;{let s=t.get(e.name);return s?r.remove(new y(e.name,s)):r}});return new n(i,this.indexSet_)}};var Pt,g=(()=>{class n{static get EMPTY_NODE(){return Pt||(Pt=new n(new $(ds),null,it.Default))}constructor(t,i,r){this.children_=t,this.priorityNode_=i,this.indexMap_=r,this.lazyHash_=null,this.priorityNode_&&tc(this.priorityNode_),this.children_.isEmpty()&&p(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Pt}updatePriority(t){return this.children_.isEmpty()?this:new n(this.children_,t,this.indexMap_)}getImmediateChild(t){if(t===".priority")return this.getPriority();{let i=this.children_.get(t);return i===null?Pt:i}}getChild(t){let i=v(t);return i===null?this:this.getImmediateChild(i).getChild(S(t))}hasChild(t){return this.children_.get(t)!==null}updateImmediateChild(t,i){if(p(i,"We should always be passing snapshot nodes"),t===".priority")return this.updatePriority(i);{let r=new y(t,i),s,o;i.isEmpty()?(s=this.children_.remove(t),o=this.indexMap_.removeFromIndexes(r,this.children_)):(s=this.children_.insert(t,i),o=this.indexMap_.addToIndexes(r,this.children_));let a=s.isEmpty()?Pt:this.priorityNode_;return new n(s,a,o)}}updateChild(t,i){let r=v(t);if(r===null)return i;{p(v(t)!==".priority"||ye(t)===1,".priority must be the last token in a path");let s=this.getImmediateChild(r).updateChild(S(t),i);return this.updateImmediateChild(r,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(t){if(this.isEmpty())return null;let i={},r=0,s=0,o=!0;if(this.forEachChild(k,(a,c)=>{i[a]=c.val(t),r++,o&&n.INTEGER_REGEXP_.test(a)?s=Math.max(s,Number(a)):o=!1}),!t&&o&&s<2*r){let a=[];for(let c in i)a[c]=i[c];return a}else return t&&!this.getPriority().isEmpty()&&(i[".priority"]=this.getPriority().val()),i}hash(){if(this.lazyHash_===null){let t="";this.getPriority().isEmpty()||(t+="priority:"+ec(this.getPriority().val())+":"),this.forEachChild(k,(i,r)=>{let s=r.hash();s!==""&&(t+=":"+i+":"+s)}),this.lazyHash_=t===""?"":Na(t)}return this.lazyHash_}getPredecessorChildName(t,i,r){let s=this.resolveIndex_(r);if(s){let o=s.getPredecessorKey(new y(t,i));return o?o.name:null}else return this.children_.getPredecessorKey(t)}getFirstChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.minKey();return r&&r.name}else return this.children_.minKey()}getFirstChild(t){let i=this.getFirstChildName(t);return i?new y(i,this.children_.get(i)):null}getLastChildName(t){let i=this.resolveIndex_(t);if(i){let r=i.maxKey();return r&&r.name}else return this.children_.maxKey()}getLastChild(t){let i=this.getLastChildName(t);return i?new y(i,this.children_.get(i)):null}forEachChild(t,i){let r=this.resolveIndex_(t);return r?r.inorderTraversal(s=>i(s.name,s.node)):this.children_.inorderTraversal(i)}getIterator(t){return this.getIteratorFrom(t.minPost(),t)}getIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getIteratorFrom(t,s=>s);{let s=this.children_.getIteratorFrom(t.name,y.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)<0;)s.getNext(),o=s.peek();return s}}getReverseIterator(t){return this.getReverseIteratorFrom(t.maxPost(),t)}getReverseIteratorFrom(t,i){let r=this.resolveIndex_(i);if(r)return r.getReverseIteratorFrom(t,s=>s);{let s=this.children_.getReverseIteratorFrom(t.name,y.Wrap),o=s.peek();for(;o!=null&&i.compare(o,t)>0;)s.getNext(),o=s.peek();return s}}compareTo(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===qt?-1:0}withIndex(t){if(t===Ze||this.indexMap_.hasIndex(t))return this;{let i=this.indexMap_.addIndex(t,this.children_);return new n(this.children_,this.priorityNode_,i)}}isIndexed(t){return t===Ze||this.indexMap_.hasIndex(t)}equals(t){if(t===this)return!0;if(t.isLeafNode())return!1;{let i=t;if(this.getPriority().equals(i.getPriority()))if(this.children_.count()===i.children_.count()){let r=this.getIterator(k),s=i.getIterator(k),o=r.getNext(),a=s.getNext();for(;o&&a;){if(o.name!==a.name||!o.node.equals(a.node))return!1;o=r.getNext(),a=s.getNext()}return o===null&&a===null}else return!1;else return!1}}resolveIndex_(t){return t===Ze?null:this.indexMap_.get(t.toString())}}return n.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,n})(),Nr=class extends g{constructor(){super(new $(ds),g.EMPTY_NODE,it.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return g.EMPTY_NODE}isEmpty(){return!1}},qt=new Nr;Object.defineProperties(y,{MIN:{value:new y(et,g.EMPTY_NODE)},MAX:{value:new y(Fe,qt)}});Ln.__EMPTY_NODE=g.EMPTY_NODE;nt.__childrenNodeConstructor=g;ff(qt);_f(qt);var gf=!0;function O(n,e=null){if(n===null)return g.EMPTY_NODE;if(typeof n=="object"&&".priority"in n&&(e=n[".priority"]),p(e===null||typeof e=="string"||typeof e=="number"||typeof e=="object"&&".sv"in e,"Invalid priority type found: "+typeof e),typeof n=="object"&&".value"in n&&n[".value"]!==null&&(n=n[".value"]),typeof n!="object"||".sv"in n){let t=n;return new nt(t,O(e))}if(!(n instanceof Array)&&gf){let t=[],i=!1;if(U(n,(o,a)=>{if(o.substring(0,1)!=="."){let c=O(a);c.isEmpty()||(i=i||!c.getPriority().isEmpty(),t.push(new y(o,c)))}}),t.length===0)return g.EMPTY_NODE;let s=Mn(t,hf,o=>o.name,ds);if(i){let o=Mn(t,k.getCompare());return new g(s,O(e),new it({".priority":o},{".priority":k}))}else return new g(s,O(e),it.Default)}else{let t=g.EMPTY_NODE;return U(n,(i,r)=>{if(te(n,i)&&i.substring(0,1)!=="."){let s=O(r);(s.isLeafNode()||!s.isEmpty())&&(t=t.updateImmediateChild(i,s))}}),t.updatePriority(O(e))}}pf(O);var Or=class extends tt{constructor(e){super(),this.indexPath_=e,p(!I(e)&&v(e)!==".priority","Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){let i=this.extractChild(e.node),r=this.extractChild(t.node),s=i.compareTo(r);return s===0?at(e.name,t.name):s}makePost(e,t){let i=O(e),r=g.EMPTY_NODE.updateChild(this.indexPath_,i);return new y(t,r)}maxPost(){let e=g.EMPTY_NODE.updateChild(this.indexPath_,qt);return new y(Fe,e)}toString(){return Qa(this.indexPath_,0).join("/")}};var Dr=class extends tt{compare(e,t){let i=e.node.compareTo(t.node);return i===0?at(e.name,t.name):i}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return y.MIN}maxPost(){return y.MAX}makePost(e,t){let i=O(e);return new y(t,i)}toString(){return".value"}},vf=new Dr;function rc(n){return{type:"value",snapshotNode:n}}function rt(n,e){return{type:"child_added",snapshotNode:e,childName:n}}function Ft(n,e){return{type:"child_removed",snapshotNode:e,childName:n}}function Ut(n,e,t){return{type:"child_changed",snapshotNode:e,childName:n,oldSnap:t}}function yf(n,e){return{type:"child_moved",snapshotNode:e,childName:n}}var Wt=class{constructor(e){this.index_=e}updateChild(e,t,i,r,s,o){p(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");let a=e.getImmediateChild(t);return a.getChild(r).equals(i.getChild(r))&&a.isEmpty()===i.isEmpty()||(o!=null&&(i.isEmpty()?e.hasChild(t)?o.trackChildChange(Ft(t,a)):p(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(rt(t,i)):o.trackChildChange(Ut(t,i,a))),e.isLeafNode()&&i.isEmpty())?e:e.updateImmediateChild(t,i).withIndex(this.index_)}updateFullNode(e,t,i){return i!=null&&(e.isLeafNode()||e.forEachChild(k,(r,s)=>{t.hasChild(r)||i.trackChildChange(Ft(r,s))}),t.isLeafNode()||t.forEachChild(k,(r,s)=>{if(e.hasChild(r)){let o=e.getImmediateChild(r);o.equals(s)||i.trackChildChange(Ut(r,s,o))}else i.trackChildChange(rt(r,s))})),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?g.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}};var xn=class n{constructor(e){this.indexedFilter_=new Wt(e.getIndex()),this.index_=e.getIndex(),this.startPost_=n.getStartPost_(e),this.endPost_=n.getEndPost_(e),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){let t=this.startIsInclusive_?this.index_.compare(this.getStartPost(),e)<=0:this.index_.compare(this.getStartPost(),e)<0,i=this.endIsInclusive_?this.index_.compare(e,this.getEndPost())<=0:this.index_.compare(e,this.getEndPost())<0;return t&&i}updateChild(e,t,i,r,s,o){return this.matches(new y(t,i))||(i=g.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,i,r,s,o)}updateFullNode(e,t,i){t.isLeafNode()&&(t=g.EMPTY_NODE);let r=t.withIndex(this.index_);r=r.updatePriority(g.EMPTY_NODE);let s=this;return t.forEachChild(k,(o,a)=>{s.matches(new y(o,a))||(r=r.updateImmediateChild(o,g.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){let t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}else return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){let t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}else return e.getIndex().maxPost()}};var Lr=class{constructor(e){this.withinDirectionalStart=t=>this.reverse_?this.withinEndPost(t):this.withinStartPost(t),this.withinDirectionalEnd=t=>this.reverse_?this.withinStartPost(t):this.withinEndPost(t),this.withinStartPost=t=>{let i=this.index_.compare(this.rangedFilter_.getStartPost(),t);return this.startIsInclusive_?i<=0:i<0},this.withinEndPost=t=>{let i=this.index_.compare(t,this.rangedFilter_.getEndPost());return this.endIsInclusive_?i<=0:i<0},this.rangedFilter_=new xn(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft(),this.startIsInclusive_=!e.startAfterSet_,this.endIsInclusive_=!e.endBeforeSet_}updateChild(e,t,i,r,s,o){return this.rangedFilter_.matches(new y(t,i))||(i=g.EMPTY_NODE),e.getImmediateChild(t).equals(i)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,i,r,s,o):this.fullLimitUpdateChild_(e,t,i,s,o)}updateFullNode(e,t,i){let r;if(t.isLeafNode()||t.isEmpty())r=g.EMPTY_NODE.withIndex(this.index_);else if(this.limit_*2<t.numChildren()&&t.isIndexed(this.index_)){r=g.EMPTY_NODE.withIndex(this.index_);let s;this.reverse_?s=t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):s=t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let o=0;for(;s.hasNext()&&o<this.limit_;){let a=s.getNext();if(this.withinDirectionalStart(a))if(this.withinDirectionalEnd(a))r=r.updateImmediateChild(a.name,a.node),o++;else break;else continue}}else{r=t.withIndex(this.index_),r=r.updatePriority(g.EMPTY_NODE);let s;this.reverse_?s=r.getReverseIterator(this.index_):s=r.getIterator(this.index_);let o=0;for(;s.hasNext();){let a=s.getNext();o<this.limit_&&this.withinDirectionalStart(a)&&this.withinDirectionalEnd(a)?o++:r=r.updateImmediateChild(a.name,g.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,r,i)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,t,i,r,s){let o;if(this.reverse_){let d=this.index_.getCompare();o=(u,f)=>d(f,u)}else o=this.index_.getCompare();let a=e;p(a.numChildren()===this.limit_,"");let c=new y(t,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(t)){let d=a.getImmediateChild(t),u=r.getChildAfterChild(this.index_,l,this.reverse_);for(;u!=null&&(u.name===t||a.hasChild(u.name));)u=r.getChildAfterChild(this.index_,u,this.reverse_);let f=u==null?1:o(u,c);if(h&&!i.isEmpty()&&f>=0)return s?.trackChildChange(Ut(t,i,d)),a.updateImmediateChild(t,i);{s?.trackChildChange(Ft(t,d));let E=a.updateImmediateChild(t,g.EMPTY_NODE);return u!=null&&this.rangedFilter_.matches(u)?(s?.trackChildChange(rt(u.name,u.node)),E.updateImmediateChild(u.name,u.node)):E}}else return i.isEmpty()?e:h&&o(l,c)>=0?(s!=null&&(s.trackChildChange(Ft(l.name,l.node)),s.trackChildChange(rt(t,i))),a.updateImmediateChild(t,i).updateImmediateChild(l.name,g.EMPTY_NODE)):e}};var Mr=class n{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=k}hasStart(){return this.startSet_}isViewFromLeft(){return this.viewFrom_===""?this.startSet_:this.viewFrom_==="l"}getIndexStartValue(){return p(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return p(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:et}hasEnd(){return this.endSet_}getIndexEndValue(){return p(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return p(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:Fe}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&this.viewFrom_!==""}getLimit(){return p(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===k}copy(){let e=new n;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.startAfterSet_=this.startAfterSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.endBeforeSet_=this.endBeforeSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}};function If(n){return n.loadsAllData()?new Wt(n.getIndex()):n.hasLimit()?new Lr(n):new xn(n)}function ha(n){let e={};if(n.isDefault())return e;let t;if(n.index_===k?t="$priority":n.index_===vf?t="$value":n.index_===Ze?t="$key":(p(n.index_ instanceof Or,"Unrecognized index type!"),t=n.index_.toString()),e.orderBy=P(t),n.startSet_){let i=n.startAfterSet_?"startAfter":"startAt";e[i]=P(n.indexStartValue_),n.startNameSet_&&(e[i]+=","+P(n.indexStartName_))}if(n.endSet_){let i=n.endBeforeSet_?"endBefore":"endAt";e[i]=P(n.indexEndValue_),n.endNameSet_&&(e[i]+=","+P(n.indexEndName_))}return n.limitSet_&&(n.isViewFromLeft()?e.limitToFirst=n.limit_:e.limitToLast=n.limit_),e}function fa(n){let e={};if(n.startSet_&&(e.sp=n.indexStartValue_,n.startNameSet_&&(e.sn=n.indexStartName_),e.sin=!n.startAfterSet_),n.endSet_&&(e.ep=n.indexEndValue_,n.endNameSet_&&(e.en=n.indexEndName_),e.ein=!n.endBeforeSet_),n.limitSet_){e.l=n.limit_;let t=n.viewFrom_;t===""&&(n.isViewFromLeft()?t="l":t="r"),e.vf=t}return n.index_!==k&&(e.i=n.index_.toString()),e}var xr=class n extends Nn{reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,t){return t!==void 0?"tag$"+t:(p(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}constructor(e,t,i,r){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=i,this.appCheckTokenProvider_=r,this.log_=zt("p:rest:"),this.listens_={}}listen(e,t,i,r){let s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);let o=n.getListenId_(e,i),a={};this.listens_[o]=a;let c=ha(e._queryParams);this.restRequest_(s+".json",c,(l,h)=>{let d=h;if(l===404&&(d=null,l=null),l===null&&this.onDataUpdate_(s,d,!1,i),Te(this.listens_,o)===a){let u;l?l===401?u="permission_denied":u="rest_error:"+l:u="ok",r(u,null)}})}unlisten(e,t){let i=n.getListenId_(e,t);delete this.listens_[i]}get(e){let t=ha(e._queryParams),i=e._path.toString(),r=new z;return this.restRequest_(i+".json",t,(s,o)=>{let a=o;s===404&&(a=null,s=null),s===null?(this.onDataUpdate_(i,a,!1,null),r.resolve(a)):r.reject(new Error(a))}),r.promise}refreshAuthToken(e){}restRequest_(e,t={},i){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(([r,s])=>{r&&r.accessToken&&(t.auth=r.accessToken),s&&s.token&&(t.ac=s.token);let o=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+_t(t);this.log_("Sending REST request for "+o);let a=new XMLHttpRequest;a.onreadystatechange=()=>{if(i&&a.readyState===4){this.log_("REST Response for "+o+" received. status:",a.status,"response:",a.responseText);let c=null;if(a.status>=200&&a.status<300){try{c=je(a.responseText)}catch{F("Failed to parse JSON response for "+o+": "+a.responseText)}i(null,c)}else a.status!==401&&a.status!==404&&F("Got unsuccessful REST response for "+o+" Status: "+a.status),i(a.status);i=null}},a.open("GET",o,!0),a.send()})}};var Fr=class{constructor(){this.rootNode_=g.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}};function Fn(){return{value:null,children:new Map}}function sc(n,e,t){if(I(e))n.value=t,n.children.clear();else if(n.value!==null)n.value=n.value.updateChild(e,t);else{let i=v(e);n.children.has(i)||n.children.set(i,Fn());let r=n.children.get(i);e=S(e),sc(r,e,t)}}function Ur(n,e,t){n.value!==null?t(e,n.value):Ef(n,(i,r)=>{let s=new b(e.toString()+"/"+i);Ur(r,s,t)})}function Ef(n,e){n.children.forEach((t,i)=>{e(i,t)})}var Wr=class{constructor(e){this.collection_=e,this.last_=null}get(){let e=this.collection_.get(),t=Object.assign({},e);return this.last_&&U(this.last_,(i,r)=>{t[i]=t[i]-r}),this.last_=e,t}};var pa=10*1e3,wf=30*1e3,Tf=300*1e3,Vr=class{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new Wr(e);let i=pa+(wf-pa)*Math.random();Ot(this.reportStats_.bind(this),Math.floor(i))}reportStats_(){let e=this.statsListener_.get(),t={},i=!1;U(e,(r,s)=>{s>0&&te(this.statsToReport_,r)&&(t[r]=s,i=!0)}),i&&this.server_.reportStats(t),Ot(this.reportStats_.bind(this),Math.floor(Math.random()*2*Tf))}};var re=(function(n){return n[n.OVERWRITE=0]="OVERWRITE",n[n.MERGE=1]="MERGE",n[n.ACK_USER_WRITE=2]="ACK_USER_WRITE",n[n.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",n})(re||{});function oc(){return{fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}function hs(){return{fromUser:!1,fromServer:!0,queryId:null,tagged:!1}}function fs(n){return{fromUser:!1,fromServer:!0,queryId:n,tagged:!0}}var Br=class n{constructor(e,t,i){this.path=e,this.affectedTree=t,this.revert=i,this.type=re.ACK_USER_WRITE,this.source=oc()}operationForChild(e){if(I(this.path)){if(this.affectedTree.value!=null)return p(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{let t=this.affectedTree.subtree(new b(e));return new n(w(),t,this.revert)}}else return p(v(this.path)===e,"operationForChild called for unrelated child."),new n(S(this.path),this.affectedTree,this.revert)}};var Un=class n{constructor(e,t){this.source=e,this.path=t,this.type=re.LISTEN_COMPLETE}operationForChild(e){return I(this.path)?new n(this.source,w()):new n(this.source,S(this.path))}};var st=class n{constructor(e,t,i){this.source=e,this.path=t,this.snap=i,this.type=re.OVERWRITE}operationForChild(e){return I(this.path)?new n(this.source,w(),this.snap.getImmediateChild(e)):new n(this.source,S(this.path),this.snap)}};var Wn=class n{constructor(e,t,i){this.source=e,this.path=t,this.children=i,this.type=re.MERGE}operationForChild(e){if(I(this.path)){let t=this.children.subtree(new b(e));return t.isEmpty()?null:t.value?new st(this.source,w(),t.value):new n(this.source,w(),t)}else return p(v(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new n(this.source,S(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}};var se=class{constructor(e,t,i){this.node_=e,this.fullyInitialized_=t,this.filtered_=i}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(I(e))return this.isFullyInitialized()&&!this.filtered_;let t=v(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}};var Hr=class{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}};function Cf(n,e,t,i){let r=[],s=[];return e.forEach(o=>{o.type==="child_changed"&&n.index_.indexedValueChanged(o.oldSnap,o.snapshotNode)&&s.push(yf(o.childName,o.snapshotNode))}),Nt(n,r,"child_removed",e,i,t),Nt(n,r,"child_added",e,i,t),Nt(n,r,"child_moved",s,i,t),Nt(n,r,"child_changed",e,i,t),Nt(n,r,"value",e,i,t),r}function Nt(n,e,t,i,r,s){let o=i.filter(a=>a.type===t);o.sort((a,c)=>Sf(n,a,c)),o.forEach(a=>{let c=bf(n,a,s);r.forEach(l=>{l.respondsTo(a.type)&&e.push(l.createEvent(c,n.query_))})})}function bf(n,e,t){return e.type==="value"||e.type==="child_removed"||(e.prevName=t.getPredecessorChildName(e.childName,e.snapshotNode,n.index_)),e}function Sf(n,e,t){if(e.childName==null||t.childName==null)throw Ee("Should only compare child_ events.");let i=new y(e.childName,e.snapshotNode),r=new y(t.childName,t.snapshotNode);return n.index_.compare(i,r)}function Zn(n,e){return{eventCache:n,serverCache:e}}function Lt(n,e,t,i){return Zn(new se(e,t,i),n.serverCache)}function ac(n,e,t,i){return Zn(n.eventCache,new se(e,t,i))}function Vn(n){return n.eventCache.isFullyInitialized()?n.eventCache.getNode():null}function Ue(n){return n.serverCache.isFullyInitialized()?n.serverCache.getNode():null}var ur,Af=()=>(ur||(ur=new $(Ah)),ur),W=class n{static fromObject(e){let t=new n(null);return U(e,(i,r)=>{t=t.set(new b(i),r)}),t}constructor(e,t=Af()){this.value=e,this.children=t}isEmpty(){return this.value===null&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(this.value!=null&&t(this.value))return{path:w(),value:this.value};if(I(e))return null;{let i=v(e),r=this.children.get(i);if(r!==null){let s=r.findRootMostMatchingPathAndValue(S(e),t);return s!=null?{path:N(new b(i),s.path),value:s.value}:null}else return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,()=>!0)}subtree(e){if(I(e))return this;{let t=v(e),i=this.children.get(t);return i!==null?i.subtree(S(e)):new n(null)}}set(e,t){if(I(e))return new n(t,this.children);{let i=v(e),s=(this.children.get(i)||new n(null)).set(S(e),t),o=this.children.insert(i,s);return new n(this.value,o)}}remove(e){if(I(e))return this.children.isEmpty()?new n(null):new n(null,this.children);{let t=v(e),i=this.children.get(t);if(i){let r=i.remove(S(e)),s;return r.isEmpty()?s=this.children.remove(t):s=this.children.insert(t,r),this.value===null&&s.isEmpty()?new n(null):new n(this.value,s)}else return this}}get(e){if(I(e))return this.value;{let t=v(e),i=this.children.get(t);return i?i.get(S(e)):null}}setTree(e,t){if(I(e))return t;{let i=v(e),s=(this.children.get(i)||new n(null)).setTree(S(e),t),o;return s.isEmpty()?o=this.children.remove(i):o=this.children.insert(i,s),new n(this.value,o)}}fold(e){return this.fold_(w(),e)}fold_(e,t){let i={};return this.children.inorderTraversal((r,s)=>{i[r]=s.fold_(N(e,r),t)}),t(e,this.value,i)}findOnPath(e,t){return this.findOnPath_(e,w(),t)}findOnPath_(e,t,i){let r=this.value?i(t,this.value):!1;if(r)return r;if(I(e))return null;{let s=v(e),o=this.children.get(s);return o?o.findOnPath_(S(e),N(t,s),i):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,w(),t)}foreachOnPath_(e,t,i){if(I(e))return this;{this.value&&i(t,this.value);let r=v(e),s=this.children.get(r);return s?s.foreachOnPath_(S(e),N(t,r),i):new n(null)}}foreach(e){this.foreach_(w(),e)}foreach_(e,t){this.children.inorderTraversal((i,r)=>{r.foreach_(N(e,i),t)}),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal((t,i)=>{i.value&&e(t,i.value)})}};var X=class n{constructor(e){this.writeTree_=e}static empty(){return new n(new W(null))}};function Mt(n,e,t){if(I(e))return new X(new W(t));{let i=n.writeTree_.findRootMostValueAndPath(e);if(i!=null){let r=i.path,s=i.value,o=M(r,e);return s=s.updateChild(o,t),new X(n.writeTree_.set(r,s))}else{let r=new W(t),s=n.writeTree_.setTree(e,r);return new X(s)}}}function _a(n,e,t){let i=n;return U(t,(r,s)=>{i=Mt(i,N(e,r),s)}),i}function ma(n,e){if(I(e))return X.empty();{let t=n.writeTree_.setTree(e,new W(null));return new X(t)}}function $r(n,e){return Ve(n,e)!=null}function Ve(n,e){let t=n.writeTree_.findRootMostValueAndPath(e);return t!=null?n.writeTree_.get(t.path).getChild(M(t.path,e)):null}function ga(n){let e=[],t=n.writeTree_.value;return t!=null?t.isLeafNode()||t.forEachChild(k,(i,r)=>{e.push(new y(i,r))}):n.writeTree_.children.inorderTraversal((i,r)=>{r.value!=null&&e.push(new y(i,r.value))}),e}function ge(n,e){if(I(e))return n;{let t=Ve(n,e);return t!=null?new X(new W(t)):new X(n.writeTree_.subtree(e))}}function jr(n){return n.writeTree_.isEmpty()}function ot(n,e){return cc(w(),n.writeTree_,e)}function cc(n,e,t){if(e.value!=null)return t.updateChild(n,e.value);{let i=null;return e.children.inorderTraversal((r,s)=>{r===".priority"?(p(s.value!==null,"Priority writes must always be leaf nodes"),i=s.value):t=cc(N(n,r),s,t)}),!t.getChild(n).isEmpty()&&i!==null&&(t=t.updateChild(N(n,".priority"),i)),t}}function ei(n,e){return hc(e,n)}function kf(n,e,t,i,r){p(i>n.lastWriteId,"Stacking an older write on top of newer ones"),r===void 0&&(r=!0),n.allWrites.push({path:e,snap:t,writeId:i,visible:r}),r&&(n.visibleWrites=Mt(n.visibleWrites,e,t)),n.lastWriteId=i}function Rf(n,e){for(let t=0;t<n.allWrites.length;t++){let i=n.allWrites[t];if(i.writeId===e)return i}return null}function Pf(n,e){let t=n.allWrites.findIndex(a=>a.writeId===e);p(t>=0,"removeWrite called with nonexistent writeId.");let i=n.allWrites[t];n.allWrites.splice(t,1);let r=i.visible,s=!1,o=n.allWrites.length-1;for(;r&&o>=0;){let a=n.allWrites[o];a.visible&&(o>=t&&Nf(a,i.path)?r=!1:Q(i.path,a.path)&&(s=!0)),o--}if(r){if(s)return Of(n),!0;if(i.snap)n.visibleWrites=ma(n.visibleWrites,i.path);else{let a=i.children;U(a,c=>{n.visibleWrites=ma(n.visibleWrites,N(i.path,c))})}return!0}else return!1}function Nf(n,e){if(n.snap)return Q(n.path,e);for(let t in n.children)if(n.children.hasOwnProperty(t)&&Q(N(n.path,t),e))return!0;return!1}function Of(n){n.visibleWrites=lc(n.allWrites,Df,w()),n.allWrites.length>0?n.lastWriteId=n.allWrites[n.allWrites.length-1].writeId:n.lastWriteId=-1}function Df(n){return n.visible}function lc(n,e,t){let i=X.empty();for(let r=0;r<n.length;++r){let s=n[r];if(e(s)){let o=s.path,a;if(s.snap)Q(t,o)?(a=M(t,o),i=Mt(i,a,s.snap)):Q(o,t)&&(a=M(o,t),i=Mt(i,w(),s.snap.getChild(a)));else if(s.children){if(Q(t,o))a=M(t,o),i=_a(i,a,s.children);else if(Q(o,t))if(a=M(o,t),I(a))i=_a(i,w(),s.children);else{let c=Te(s.children,v(a));if(c){let l=c.getChild(S(a));i=Mt(i,w(),l)}}}else throw Ee("WriteRecord should have .snap or .children")}}return i}function uc(n,e,t,i,r){if(!i&&!r){let s=Ve(n.visibleWrites,e);if(s!=null)return s;{let o=ge(n.visibleWrites,e);if(jr(o))return t;if(t==null&&!$r(o,w()))return null;{let a=t||g.EMPTY_NODE;return ot(o,a)}}}else{let s=ge(n.visibleWrites,e);if(!r&&jr(s))return t;if(!r&&t==null&&!$r(s,w()))return null;{let o=function(l){return(l.visible||r)&&(!i||!~i.indexOf(l.writeId))&&(Q(l.path,e)||Q(e,l.path))},a=lc(n.allWrites,o,e),c=t||g.EMPTY_NODE;return ot(a,c)}}}function Lf(n,e,t){let i=g.EMPTY_NODE,r=Ve(n.visibleWrites,e);if(r)return r.isLeafNode()||r.forEachChild(k,(s,o)=>{i=i.updateImmediateChild(s,o)}),i;if(t){let s=ge(n.visibleWrites,e);return t.forEachChild(k,(o,a)=>{let c=ot(ge(s,new b(o)),a);i=i.updateImmediateChild(o,c)}),ga(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}else{let s=ge(n.visibleWrites,e);return ga(s).forEach(o=>{i=i.updateImmediateChild(o.name,o.node)}),i}}function Mf(n,e,t,i,r){p(i||r,"Either existingEventSnap or existingServerSnap must exist");let s=N(e,t);if($r(n.visibleWrites,s))return null;{let o=ge(n.visibleWrites,s);return jr(o)?r.getChild(t):ot(o,r.getChild(t))}}function xf(n,e,t,i){let r=N(e,t),s=Ve(n.visibleWrites,r);if(s!=null)return s;if(i.isCompleteForChild(t)){let o=ge(n.visibleWrites,r);return ot(o,i.getNode().getImmediateChild(t))}else return null}function Ff(n,e){return Ve(n.visibleWrites,e)}function Uf(n,e,t,i,r,s,o){let a,c=ge(n.visibleWrites,e),l=Ve(c,w());if(l!=null)a=l;else if(t!=null)a=ot(c,t);else return[];if(a=a.withIndex(o),!a.isEmpty()&&!a.isLeafNode()){let h=[],d=o.getCompare(),u=s?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o),f=u.getNext();for(;f&&h.length<r;)d(f,i)!==0&&h.push(f),f=u.getNext();return h}else return[]}function Wf(){return{visibleWrites:X.empty(),allWrites:[],lastWriteId:-1}}function Bn(n,e,t,i){return uc(n.writeTree,n.treePath,e,t,i)}function ps(n,e){return Lf(n.writeTree,n.treePath,e)}function va(n,e,t,i){return Mf(n.writeTree,n.treePath,e,t,i)}function Hn(n,e){return Ff(n.writeTree,N(n.treePath,e))}function Vf(n,e,t,i,r,s){return Uf(n.writeTree,n.treePath,e,t,i,r,s)}function _s(n,e,t){return xf(n.writeTree,n.treePath,e,t)}function dc(n,e){return hc(N(n.treePath,e),n.writeTree)}function hc(n,e){return{treePath:n,writeTree:e}}var zr=class{constructor(){this.changeMap=new Map}trackChildChange(e){let t=e.type,i=e.childName;p(t==="child_added"||t==="child_changed"||t==="child_removed","Only child changes supported for tracking"),p(i!==".priority","Only non-priority child changes can be tracked.");let r=this.changeMap.get(i);if(r){let s=r.type;if(t==="child_added"&&s==="child_removed")this.changeMap.set(i,Ut(i,e.snapshotNode,r.snapshotNode));else if(t==="child_removed"&&s==="child_added")this.changeMap.delete(i);else if(t==="child_removed"&&s==="child_changed")this.changeMap.set(i,Ft(i,r.oldSnap));else if(t==="child_changed"&&s==="child_added")this.changeMap.set(i,rt(i,e.snapshotNode));else if(t==="child_changed"&&s==="child_changed")this.changeMap.set(i,Ut(i,e.snapshotNode,r.oldSnap));else throw Ee("Illegal combination of changes: "+e+" occurred after "+r)}else this.changeMap.set(i,e)}getChanges(){return Array.from(this.changeMap.values())}};var qr=class{getCompleteChild(e){return null}getChildAfterChild(e,t,i){return null}},fc=new qr,Vt=class{constructor(e,t,i=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=i}getCompleteChild(e){let t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{let i=this.optCompleteServerCache_!=null?new se(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return _s(this.writes_,e,i)}}getChildAfterChild(e,t,i){let r=this.optCompleteServerCache_!=null?this.optCompleteServerCache_:Ue(this.viewCache_),s=Vf(this.writes_,r,t,1,i,e);return s.length===0?null:s[0]}};function Bf(n){return{filter:n}}function Hf(n,e){p(e.eventCache.getNode().isIndexed(n.filter.getIndex()),"Event snap not indexed"),p(e.serverCache.getNode().isIndexed(n.filter.getIndex()),"Server snap not indexed")}function $f(n,e,t,i,r){let s=new zr,o,a;if(t.type===re.OVERWRITE){let l=t;l.source.fromUser?o=Gr(n,e,l.path,l.snap,i,r,s):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!I(l.path),o=$n(n,e,l.path,l.snap,i,r,a,s))}else if(t.type===re.MERGE){let l=t;l.source.fromUser?o=zf(n,e,l.path,l.children,i,r,s):(p(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered(),o=Kr(n,e,l.path,l.children,i,r,a,s))}else if(t.type===re.ACK_USER_WRITE){let l=t;l.revert?o=Kf(n,e,l.path,i,r,s):o=qf(n,e,l.path,l.affectedTree,i,r,s)}else if(t.type===re.LISTEN_COMPLETE)o=Gf(n,e,t.path,i,s);else throw Ee("Unknown operation type: "+t.type);let c=s.getChanges();return jf(e,o,c),{viewCache:o,changes:c}}function jf(n,e,t){let i=e.eventCache;if(i.isFullyInitialized()){let r=i.getNode().isLeafNode()||i.getNode().isEmpty(),s=Vn(n);(t.length>0||!n.eventCache.isFullyInitialized()||r&&!i.getNode().equals(s)||!i.getNode().getPriority().equals(s.getPriority()))&&t.push(rc(Vn(e)))}}function pc(n,e,t,i,r,s){let o=e.eventCache;if(Hn(i,t)!=null)return e;{let a,c;if(I(t))if(p(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){let l=Ue(e),h=l instanceof g?l:g.EMPTY_NODE,d=ps(i,h);a=n.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{let l=Bn(i,Ue(e));a=n.filter.updateFullNode(e.eventCache.getNode(),l,s)}else{let l=v(t);if(l===".priority"){p(ye(t)===1,"Can't have a priority with additional path components");let h=o.getNode();c=e.serverCache.getNode();let d=va(i,t,h,c);d!=null?a=n.filter.updatePriority(h,d):a=o.getNode()}else{let h=S(t),d;if(o.isCompleteForChild(l)){c=e.serverCache.getNode();let u=va(i,t,o.getNode(),c);u!=null?d=o.getNode().getImmediateChild(l).updateChild(h,u):d=o.getNode().getImmediateChild(l)}else d=_s(i,l,e.serverCache);d!=null?a=n.filter.updateChild(o.getNode(),l,d,h,r,s):a=o.getNode()}}return Lt(e,a,o.isFullyInitialized()||I(t),n.filter.filtersNodes())}}function $n(n,e,t,i,r,s,o,a){let c=e.serverCache,l,h=o?n.filter:n.filter.getIndexedFilter();if(I(t))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){let f=c.getNode().updateChild(t,i);l=h.updateFullNode(c.getNode(),f,null)}else{let f=v(t);if(!c.isCompleteForPath(t)&&ye(t)>1)return e;let m=S(t),A=c.getNode().getImmediateChild(f).updateChild(m,i);f===".priority"?l=h.updatePriority(c.getNode(),A):l=h.updateChild(c.getNode(),f,A,m,fc,null)}let d=ac(e,l,c.isFullyInitialized()||I(t),h.filtersNodes()),u=new Vt(r,d,s);return pc(n,d,t,r,u,a)}function Gr(n,e,t,i,r,s,o){let a=e.eventCache,c,l,h=new Vt(r,e,s);if(I(t))l=n.filter.updateFullNode(e.eventCache.getNode(),i,o),c=Lt(e,l,!0,n.filter.filtersNodes());else{let d=v(t);if(d===".priority")l=n.filter.updatePriority(e.eventCache.getNode(),i),c=Lt(e,l,a.isFullyInitialized(),a.isFiltered());else{let u=S(t),f=a.getNode().getImmediateChild(d),m;if(I(u))m=i;else{let E=h.getCompleteChild(d);E!=null?Ja(u)===".priority"&&E.getChild(Xa(u)).isEmpty()?m=E:m=E.updateChild(u,i):m=g.EMPTY_NODE}if(f.equals(m))c=e;else{let E=n.filter.updateChild(a.getNode(),d,m,u,h,o);c=Lt(e,E,a.isFullyInitialized(),n.filter.filtersNodes())}}}return c}function ya(n,e){return n.eventCache.isCompleteForChild(e)}function zf(n,e,t,i,r,s,o){let a=e;return i.foreach((c,l)=>{let h=N(t,c);ya(e,v(h))&&(a=Gr(n,a,h,l,r,s,o))}),i.foreach((c,l)=>{let h=N(t,c);ya(e,v(h))||(a=Gr(n,a,h,l,r,s,o))}),a}function Ia(n,e,t){return t.foreach((i,r)=>{e=e.updateChild(i,r)}),e}function Kr(n,e,t,i,r,s,o,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;let c=e,l;I(t)?l=i:l=new W(null).setTree(t,i);let h=e.serverCache.getNode();return l.children.inorderTraversal((d,u)=>{if(h.hasChild(d)){let f=e.serverCache.getNode().getImmediateChild(d),m=Ia(n,f,u);c=$n(n,c,new b(d),m,r,s,o,a)}}),l.children.inorderTraversal((d,u)=>{let f=!e.serverCache.isCompleteForChild(d)&&u.value===null;if(!h.hasChild(d)&&!f){let m=e.serverCache.getNode().getImmediateChild(d),E=Ia(n,m,u);c=$n(n,c,new b(d),E,r,s,o,a)}}),c}function qf(n,e,t,i,r,s,o){if(Hn(r,t)!=null)return e;let a=e.serverCache.isFiltered(),c=e.serverCache;if(i.value!=null){if(I(t)&&c.isFullyInitialized()||c.isCompleteForPath(t))return $n(n,e,t,c.getNode().getChild(t),r,s,a,o);if(I(t)){let l=new W(null);return c.getNode().forEachChild(Ze,(h,d)=>{l=l.set(new b(h),d)}),Kr(n,e,t,l,r,s,a,o)}else return e}else{let l=new W(null);return i.foreach((h,d)=>{let u=N(t,h);c.isCompleteForPath(u)&&(l=l.set(h,c.getNode().getChild(u)))}),Kr(n,e,t,l,r,s,a,o)}}function Gf(n,e,t,i,r){let s=e.serverCache,o=ac(e,s.getNode(),s.isFullyInitialized()||I(t),s.isFiltered());return pc(n,o,t,i,fc,r)}function Kf(n,e,t,i,r,s){let o;if(Hn(i,t)!=null)return e;{let a=new Vt(i,e,r),c=e.eventCache.getNode(),l;if(I(t)||v(t)===".priority"){let h;if(e.serverCache.isFullyInitialized())h=Bn(i,Ue(e));else{let d=e.serverCache.getNode();p(d instanceof g,"serverChildren would be complete if leaf node"),h=ps(i,d)}h=h,l=n.filter.updateFullNode(c,h,s)}else{let h=v(t),d=_s(i,h,e.serverCache);d==null&&e.serverCache.isCompleteForChild(h)&&(d=c.getImmediateChild(h)),d!=null?l=n.filter.updateChild(c,h,d,S(t),a,s):e.eventCache.getNode().hasChild(h)?l=n.filter.updateChild(c,h,g.EMPTY_NODE,S(t),a,s):l=c,l.isEmpty()&&e.serverCache.isFullyInitialized()&&(o=Bn(i,Ue(e)),o.isLeafNode()&&(l=n.filter.updateFullNode(l,o,s)))}return o=e.serverCache.isFullyInitialized()||Hn(i,w())!=null,Lt(e,l,o,n.filter.filtersNodes())}}var Yr=class{constructor(e,t){this.query_=e,this.eventRegistrations_=[];let i=this.query_._queryParams,r=new Wt(i.getIndex()),s=If(i);this.processor_=Bf(s);let o=t.serverCache,a=t.eventCache,c=r.updateFullNode(g.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(g.EMPTY_NODE,a.getNode(),null),h=new se(c,o.isFullyInitialized(),r.filtersNodes()),d=new se(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Zn(d,h),this.eventGenerator_=new Hr(this.query_)}get query(){return this.query_}};function Yf(n){return n.viewCache_.serverCache.getNode()}function Jf(n){return Vn(n.viewCache_)}function Qf(n,e){let t=Ue(n.viewCache_);return t&&(n.query._queryParams.loadsAllData()||!I(e)&&!t.getImmediateChild(v(e)).isEmpty())?t.getChild(e):null}function Ea(n){return n.eventRegistrations_.length===0}function Xf(n,e){n.eventRegistrations_.push(e)}function wa(n,e,t){let i=[];if(t){p(e==null,"A cancel should cancel all event registrations.");let r=n.query._path;n.eventRegistrations_.forEach(s=>{let o=s.createCancelEvent(t,r);o&&i.push(o)})}if(e){let r=[];for(let s=0;s<n.eventRegistrations_.length;++s){let o=n.eventRegistrations_[s];if(!o.matches(e))r.push(o);else if(e.hasAnyCallback()){r=r.concat(n.eventRegistrations_.slice(s+1));break}}n.eventRegistrations_=r}else n.eventRegistrations_=[];return i}function Ta(n,e,t,i){e.type===re.MERGE&&e.source.queryId!==null&&(p(Ue(n.viewCache_),"We should always have a full cache before handling merges"),p(Vn(n.viewCache_),"Missing event cache, even though we have a server cache"));let r=n.viewCache_,s=$f(n.processor_,r,e,t,i);return Hf(n.processor_,s.viewCache),p(s.viewCache.serverCache.isFullyInitialized()||!r.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),n.viewCache_=s.viewCache,_c(n,s.changes,s.viewCache.eventCache.getNode(),null)}function Zf(n,e){let t=n.viewCache_.eventCache,i=[];return t.getNode().isLeafNode()||t.getNode().forEachChild(k,(s,o)=>{i.push(rt(s,o))}),t.isFullyInitialized()&&i.push(rc(t.getNode())),_c(n,i,t.getNode(),e)}function _c(n,e,t,i){let r=i?[i]:n.eventRegistrations_;return Cf(n.eventGenerator_,e,t,r)}var jn,zn=class{constructor(){this.views=new Map}};function ep(n){p(!jn,"__referenceConstructor has already been defined"),jn=n}function tp(){return p(jn,"Reference.ts has not been loaded"),jn}function np(n){return n.views.size===0}function ms(n,e,t,i){let r=e.source.queryId;if(r!==null){let s=n.views.get(r);return p(s!=null,"SyncTree gave us an op for an invalid query."),Ta(s,e,t,i)}else{let s=[];for(let o of n.views.values())s=s.concat(Ta(o,e,t,i));return s}}function mc(n,e,t,i,r){let s=e._queryIdentifier,o=n.views.get(s);if(!o){let a=Bn(t,r?i:null),c=!1;a?c=!0:i instanceof g?(a=ps(t,i),c=!1):(a=g.EMPTY_NODE,c=!1);let l=Zn(new se(a,c,!1),new se(i,r,!1));return new Yr(e,l)}return o}function ip(n,e,t,i,r,s){let o=mc(n,e,i,r,s);return n.views.has(e._queryIdentifier)||n.views.set(e._queryIdentifier,o),Xf(o,t),Zf(o,t)}function rp(n,e,t,i){let r=e._queryIdentifier,s=[],o=[],a=Ie(n);if(r==="default")for(let[c,l]of n.views.entries())o=o.concat(wa(l,t,i)),Ea(l)&&(n.views.delete(c),l.query._queryParams.loadsAllData()||s.push(l.query));else{let c=n.views.get(r);c&&(o=o.concat(wa(c,t,i)),Ea(c)&&(n.views.delete(r),c.query._queryParams.loadsAllData()||s.push(c.query)))}return a&&!Ie(n)&&s.push(new(tp())(e._repo,e._path)),{removed:s,events:o}}function gc(n){let e=[];for(let t of n.views.values())t.query._queryParams.loadsAllData()||e.push(t);return e}function ve(n,e){let t=null;for(let i of n.views.values())t=t||Qf(i,e);return t}function vc(n,e){if(e._queryParams.loadsAllData())return ti(n);{let i=e._queryIdentifier;return n.views.get(i)}}function yc(n,e){return vc(n,e)!=null}function Ie(n){return ti(n)!=null}function ti(n){for(let e of n.views.values())if(e.query._queryParams.loadsAllData())return e;return null}var qn;function sp(n){p(!qn,"__referenceConstructor has already been defined"),qn=n}function op(){return p(qn,"Reference.ts has not been loaded"),qn}var ap=1,Gn=class{constructor(e){this.listenProvider_=e,this.syncPointTree_=new W(null),this.pendingWriteTree_=Wf(),this.tagToQueryMap=new Map,this.queryToTagMap=new Map}};function Ic(n,e,t,i,r){return kf(n.pendingWriteTree_,e,t,i,r),r?Kt(n,new st(oc(),e,t)):[]}function Me(n,e,t=!1){let i=Rf(n.pendingWriteTree_,e);if(Pf(n.pendingWriteTree_,e)){let s=new W(null);return i.snap!=null?s=s.set(w(),!0):U(i.children,o=>{s=s.set(new b(o),!0)}),Kt(n,new Br(i.path,s,t))}else return[]}function Gt(n,e,t){return Kt(n,new st(hs(),e,t))}function cp(n,e,t){let i=W.fromObject(t);return Kt(n,new Wn(hs(),e,i))}function lp(n,e){return Kt(n,new Un(hs(),e))}function up(n,e,t){let i=vs(n,t);if(i){let r=ys(i),s=r.path,o=r.queryId,a=M(s,e),c=new Un(fs(o),a);return Is(n,s,c)}else return[]}function Kn(n,e,t,i,r=!1){let s=e._path,o=n.syncPointTree_.get(s),a=[];if(o&&(e._queryIdentifier==="default"||yc(o,e))){let c=rp(o,e,t,i);np(o)&&(n.syncPointTree_=n.syncPointTree_.remove(s));let l=c.removed;if(a=c.events,!r){let h=l.findIndex(u=>u._queryParams.loadsAllData())!==-1,d=n.syncPointTree_.findOnPath(s,(u,f)=>Ie(f));if(h&&!d){let u=n.syncPointTree_.subtree(s);if(!u.isEmpty()){let f=fp(u);for(let m=0;m<f.length;++m){let E=f[m],A=E.query,V=Cc(n,E);n.listenProvider_.startListening(xt(A),Bt(n,A),V.hashFn,V.onComplete)}}}!d&&l.length>0&&!i&&(h?n.listenProvider_.stopListening(xt(e),null):l.forEach(u=>{let f=n.queryToTagMap.get(ni(u));n.listenProvider_.stopListening(xt(u),f)}))}pp(n,l)}return a}function Ec(n,e,t,i){let r=vs(n,i);if(r!=null){let s=ys(r),o=s.path,a=s.queryId,c=M(o,e),l=new st(fs(a),c,t);return Is(n,o,l)}else return[]}function dp(n,e,t,i){let r=vs(n,i);if(r){let s=ys(r),o=s.path,a=s.queryId,c=M(o,e),l=W.fromObject(t),h=new Wn(fs(a),c,l);return Is(n,o,h)}else return[]}function Jr(n,e,t,i=!1){let r=e._path,s=null,o=!1;n.syncPointTree_.foreachOnPath(r,(u,f)=>{let m=M(u,r);s=s||ve(f,m),o=o||Ie(f)});let a=n.syncPointTree_.get(r);a?(o=o||Ie(a),s=s||ve(a,w())):(a=new zn,n.syncPointTree_=n.syncPointTree_.set(r,a));let c;s!=null?c=!0:(c=!1,s=g.EMPTY_NODE,n.syncPointTree_.subtree(r).foreachChild((f,m)=>{let E=ve(m,w());E&&(s=s.updateImmediateChild(f,E))}));let l=yc(a,e);if(!l&&!e._queryParams.loadsAllData()){let u=ni(e);p(!n.queryToTagMap.has(u),"View does not exist, but we have a tag");let f=_p();n.queryToTagMap.set(u,f),n.tagToQueryMap.set(f,u)}let h=ei(n.pendingWriteTree_,r),d=ip(a,e,t,h,s,c);if(!l&&!o&&!i){let u=vc(a,e);d=d.concat(mp(n,e,u))}return d}function gs(n,e,t){let r=n.pendingWriteTree_,s=n.syncPointTree_.findOnPath(e,(o,a)=>{let c=M(o,e),l=ve(a,c);if(l)return l});return uc(r,e,s,t,!0)}function hp(n,e){let t=e._path,i=null;n.syncPointTree_.foreachOnPath(t,(l,h)=>{let d=M(l,t);i=i||ve(h,d)});let r=n.syncPointTree_.get(t);r?i=i||ve(r,w()):(r=new zn,n.syncPointTree_=n.syncPointTree_.set(t,r));let s=i!=null,o=s?new se(i,!0,!1):null,a=ei(n.pendingWriteTree_,e._path),c=mc(r,e,a,s?o.getNode():g.EMPTY_NODE,s);return Jf(c)}function Kt(n,e){return wc(e,n.syncPointTree_,null,ei(n.pendingWriteTree_,w()))}function wc(n,e,t,i){if(I(n.path))return Tc(n,e,t,i);{let r=e.get(w());t==null&&r!=null&&(t=ve(r,w()));let s=[],o=v(n.path),a=n.operationForChild(o),c=e.children.get(o);if(c&&a){let l=t?t.getImmediateChild(o):null,h=dc(i,o);s=s.concat(wc(a,c,l,h))}return r&&(s=s.concat(ms(r,n,i,t))),s}}function Tc(n,e,t,i){let r=e.get(w());t==null&&r!=null&&(t=ve(r,w()));let s=[];return e.children.inorderTraversal((o,a)=>{let c=t?t.getImmediateChild(o):null,l=dc(i,o),h=n.operationForChild(o);h&&(s=s.concat(Tc(h,a,c,l)))}),r&&(s=s.concat(ms(r,n,i,t))),s}function Cc(n,e){let t=e.query,i=Bt(n,t);return{hashFn:()=>(Yf(e)||g.EMPTY_NODE).hash(),onComplete:r=>{if(r==="ok")return i?up(n,t._path,i):lp(n,t._path);{let s=Ph(r,t);return Kn(n,t,null,s)}}}}function Bt(n,e){let t=ni(e);return n.queryToTagMap.get(t)}function ni(n){return n._path.toString()+"$"+n._queryIdentifier}function vs(n,e){return n.tagToQueryMap.get(e)}function ys(n){let e=n.indexOf("$");return p(e!==-1&&e<n.length-1,"Bad queryKey."),{queryId:n.substr(e+1),path:new b(n.substr(0,e))}}function Is(n,e,t){let i=n.syncPointTree_.get(e);p(i,"Missing sync point for query tag that we're tracking");let r=ei(n.pendingWriteTree_,e);return ms(i,t,r,null)}function fp(n){return n.fold((e,t,i)=>{if(t&&Ie(t))return[ti(t)];{let r=[];return t&&(r=gc(t)),U(i,(s,o)=>{r=r.concat(o)}),r}})}function xt(n){return n._queryParams.loadsAllData()&&!n._queryParams.isDefault()?new(op())(n._repo,n._path):n}function pp(n,e){for(let t=0;t<e.length;++t){let i=e[t];if(!i._queryParams.loadsAllData()){let r=ni(i),s=n.queryToTagMap.get(r);n.queryToTagMap.delete(r),n.tagToQueryMap.delete(s)}}}function _p(){return ap++}function mp(n,e,t){let i=e._path,r=Bt(n,e),s=Cc(n,t),o=n.listenProvider_.startListening(xt(e),r,s.hashFn,s.onComplete),a=n.syncPointTree_.subtree(i);if(r)p(!Ie(a.value),"If we're adding a query, it shouldn't be shadowed");else{let c=a.fold((l,h,d)=>{if(!I(l)&&h&&Ie(h))return[ti(h).query];{let u=[];return h&&(u=u.concat(gc(h).map(f=>f.query))),U(d,(f,m)=>{u=u.concat(m)}),u}});for(let l=0;l<c.length;++l){let h=c[l];n.listenProvider_.stopListening(xt(h),Bt(n,h))}}return o}var Qr=class n{constructor(e){this.node_=e}getImmediateChild(e){let t=this.node_.getImmediateChild(e);return new n(t)}node(){return this.node_}},Xr=class n{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){let t=N(this.path_,e);return new n(this.syncTree_,t)}node(){return gs(this.syncTree_,this.path_)}},gp=function(n){return n=n||{},n.timestamp=n.timestamp||new Date().getTime(),n},Ca=function(n,e,t){if(!n||typeof n!="object")return n;if(p(".sv"in n,"Unexpected leaf node or priority contents"),typeof n[".sv"]=="string")return vp(n[".sv"],e,t);if(typeof n[".sv"]=="object")return yp(n[".sv"],e);p(!1,"Unexpected server value: "+JSON.stringify(n,null,2))},vp=function(n,e,t){switch(n){case"timestamp":return t.timestamp;default:p(!1,"Unexpected server value: "+n)}},yp=function(n,e,t){n.hasOwnProperty("increment")||p(!1,"Unexpected server value: "+JSON.stringify(n,null,2));let i=n.increment;typeof i!="number"&&p(!1,"Unexpected increment value: "+i);let r=e.node();if(p(r!==null&&typeof r<"u","Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return i;let o=r.getValue();return typeof o!="number"?i:o+i},Ip=function(n,e,t,i){return Es(e,new Xr(t,n),i)},bc=function(n,e,t){return Es(n,new Qr(e),t)};function Es(n,e,t){let i=n.getPriority().val(),r=Ca(i,e.getImmediateChild(".priority"),t),s;if(n.isLeafNode()){let o=n,a=Ca(o.getValue(),e,t);return a!==o.getValue()||r!==o.getPriority().val()?new nt(a,O(r)):n}else{let o=n;return s=o,r!==o.getPriority().val()&&(s=s.updatePriority(new nt(r))),o.forEachChild(k,(a,c)=>{let l=Es(c,e.getImmediateChild(a),t);l!==c&&(s=s.updateImmediateChild(a,l))}),s}}var Ht=class{constructor(e="",t=null,i={children:{},childCount:0}){this.name=e,this.parent=t,this.node=i}};function ws(n,e){let t=e instanceof b?e:new b(e),i=n,r=v(t);for(;r!==null;){let s=Te(i.node.children,r)||{children:{},childCount:0};i=new Ht(r,i,s),t=S(t),r=v(t)}return i}function lt(n){return n.node.value}function Sc(n,e){n.node.value=e,Zr(n)}function Ac(n){return n.node.childCount>0}function Ep(n){return lt(n)===void 0&&!Ac(n)}function ii(n,e){U(n.node.children,(t,i)=>{e(new Ht(t,n,i))})}function kc(n,e,t,i){t&&!i&&e(n),ii(n,r=>{kc(r,e,!0,i)}),t&&i&&e(n)}function wp(n,e,t){let i=t?n:n.parent;for(;i!==null;){if(e(i))return!0;i=i.parent}return!1}function Yt(n){return new b(n.parent===null?n.name:Yt(n.parent)+"/"+n.name)}function Zr(n){n.parent!==null&&Tp(n.parent,n.name,n)}function Tp(n,e,t){let i=Ep(t),r=te(n.node.children,e);i&&r?(delete n.node.children[e],n.node.childCount--,Zr(n)):!i&&!r&&(n.node.children[e]=t.node,n.node.childCount++,Zr(n))}var Cp=/[\[\].#$\/\u0000-\u001F\u007F]/,bp=/[\[\].#$\u0000-\u001F\u007F]/,dr=10*1024*1024,Rc=function(n){return typeof n=="string"&&n.length!==0&&!Cp.test(n)},Pc=function(n){return typeof n=="string"&&n.length!==0&&!bp.test(n)},Sp=function(n){return n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Pc(n)};var Nc=function(n,e,t,i){i&&e===void 0||Ts(on(n,"value"),e,t)},Ts=function(n,e,t){let i=t instanceof b?new br(t,n):t;if(e===void 0)throw new Error(n+"contains undefined "+De(i));if(typeof e=="function")throw new Error(n+"contains a function "+De(i)+" with contents = "+e.toString());if(Oa(e))throw new Error(n+"contains "+e.toString()+" "+De(i));if(typeof e=="string"&&e.length>dr/3&&mt(e)>dr)throw new Error(n+"contains a string greater than "+dr+" utf8 bytes "+De(i)+" ('"+e.substring(0,50)+"...')");if(e&&typeof e=="object"){let r=!1,s=!1;if(U(e,(o,a)=>{if(o===".value")r=!0;else if(o!==".priority"&&o!==".sv"&&(s=!0,!Rc(o)))throw new Error(n+" contains an invalid key ("+o+") "+De(i)+`.  Keys must be non-empty strings and can't contain ".", "#", "$", "/", "[", or "]"`);of(i,o),Ts(n,a,i),af(i)}),r&&s)throw new Error(n+' contains ".value" child '+De(i)+" in addition to actual children.")}};var Oc=function(n,e,t,i){if(!(i&&t===void 0)&&!Pc(t))throw new Error(on(n,e)+'was an invalid path = "'+t+`". Paths must be non-empty strings and can't contain ".", "#", "$", "[", or "]"`)},Ap=function(n,e,t,i){t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Oc(n,e,t,i)},Cs=function(n,e){if(v(e)===".info")throw new Error(n+" failed = Can't modify data under /.info/")},kp=function(n,e){let t=e.path.toString();if(typeof e.repoInfo.host!="string"||e.repoInfo.host.length===0||!Rc(e.repoInfo.namespace)&&e.repoInfo.host.split(":")[0]!=="localhost"||t.length!==0&&!Sp(t))throw new Error(on(n,"url")+`must be a valid firebase URL and the path can't contain ".", "#", "$", "[", or "]".`)};var es=class{constructor(){this.eventLists_=[],this.recursionDepth_=0}};function bs(n,e){let t=null;for(let i=0;i<e.length;i++){let r=e[i],s=r.getPath();t!==null&&!ls(s,t.path)&&(n.eventLists_.push(t),t=null),t===null&&(t={events:[],path:s}),t.events.push(r)}t&&n.eventLists_.push(t)}function Dc(n,e,t){bs(n,t),Lc(n,i=>ls(i,e))}function oe(n,e,t){bs(n,t),Lc(n,i=>Q(i,e)||Q(e,i))}function Lc(n,e){n.recursionDepth_++;let t=!0;for(let i=0;i<n.eventLists_.length;i++){let r=n.eventLists_[i];if(r){let s=r.path;e(s)?(Rp(n.eventLists_[i]),n.eventLists_[i]=null):t=!1}}t&&(n.eventLists_=[]),n.recursionDepth_--}function Rp(n){for(let e=0;e<n.events.length;e++){let t=n.events[e];if(t!==null){n.events[e]=null;let i=t.getEventRunner();xe&&D("event: "+t.toString()),ct(i)}}}var Pp="repo_interrupt",Np=25,ts=class{constructor(e,t,i,r){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=i,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new es,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Fn(),this.transactionQueueTree_=new Ht,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}};function Op(n,e,t){if(n.stats_=cs(n.repoInfo_),n.forceRestClient_||Lh())n.server_=new xr(n.repoInfo_,(i,r,s,o)=>{ba(n,i,r,s,o)},n.authTokenProvider_,n.appCheckProvider_),setTimeout(()=>Sa(n,!0),0);else{if(typeof t<"u"&&t!==null){if(typeof t!="object")throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{P(t)}catch(i){throw new Error("Invalid authOverride provided: "+i)}}n.persistentConnection_=new us(n.repoInfo_,e,(i,r,s,o)=>{ba(n,i,r,s,o)},i=>{Sa(n,i)},i=>{Dp(n,i)},n.authTokenProvider_,n.appCheckProvider_,t),n.server_=n.persistentConnection_}n.authTokenProvider_.addTokenChangeListener(i=>{n.server_.refreshAuthToken(i)}),n.appCheckProvider_.addTokenChangeListener(i=>{n.server_.refreshAppCheckToken(i.token)}),n.statsReporter_=xh(n.repoInfo_,()=>new Vr(n.stats_,n.server_)),n.infoData_=new Fr,n.infoSyncTree_=new Gn({startListening:(i,r,s,o)=>{let a=[],c=n.infoData_.getNode(i._path);return c.isEmpty()||(a=Gt(n.infoSyncTree_,i._path,c),setTimeout(()=>{o("ok")},0)),a},stopListening:()=>{}}),As(n,"connected",!1),n.serverSyncTree_=new Gn({startListening:(i,r,s,o)=>(n.server_.listen(i,s,r,(a,c)=>{let l=o(a,c);oe(n.eventQueue_,i._path,l)}),[]),stopListening:(i,r)=>{n.server_.unlisten(i,r)}})}function Mc(n){let t=n.infoData_.getNode(new b(".info/serverTimeOffset")).val()||0;return new Date().getTime()+t}function Ss(n){return gp({timestamp:Mc(n)})}function ba(n,e,t,i,r){n.dataUpdateCount++;let s=new b(e);t=n.interceptServerDataCallback_?n.interceptServerDataCallback_(e,t):t;let o=[];if(r)if(i){let c=pt(t,l=>O(l));o=dp(n.serverSyncTree_,s,c,r)}else{let c=O(t);o=Ec(n.serverSyncTree_,s,c,r)}else if(i){let c=pt(t,l=>O(l));o=cp(n.serverSyncTree_,s,c)}else{let c=O(t);o=Gt(n.serverSyncTree_,s,c)}let a=s;o.length>0&&(a=si(n,s)),oe(n.eventQueue_,a,o)}function Sa(n,e){As(n,"connected",e),e===!1&&xp(n)}function Dp(n,e){U(e,(t,i)=>{As(n,t,i)})}function As(n,e,t){let i=new b("/.info/"+e),r=O(t);n.infoData_.updateSnapshot(i,r);let s=Gt(n.infoSyncTree_,i,r);oe(n.eventQueue_,i,s)}function xc(n){return n.nextWriteId_++}function Lp(n,e,t){let i=hp(n.serverSyncTree_,e);return i!=null?Promise.resolve(i):n.server_.get(e).then(r=>{let s=O(r).withIndex(e._queryParams.getIndex());Jr(n.serverSyncTree_,e,t,!0);let o;if(e._queryParams.loadsAllData())o=Gt(n.serverSyncTree_,e._path,s);else{let a=Bt(n.serverSyncTree_,e);o=Ec(n.serverSyncTree_,e._path,s,a)}return oe(n.eventQueue_,e._path,o),Kn(n.serverSyncTree_,e,t,null,!0),s},r=>(ri(n,"get for query "+P(e)+" failed: "+r),Promise.reject(new Error(r))))}function Mp(n,e,t,i,r){ri(n,"set",{path:e.toString(),value:t,priority:i});let s=Ss(n),o=O(t,i),a=gs(n.serverSyncTree_,e),c=bc(o,a,s),l=xc(n),h=Ic(n.serverSyncTree_,e,c,l,!0);bs(n.eventQueue_,h),n.server_.put(e.toString(),o.val(!0),(u,f)=>{let m=u==="ok";m||F("set at "+e+" failed: "+u);let E=Me(n.serverSyncTree_,l,!m);oe(n.eventQueue_,e,E),Wp(n,r,u,f)});let d=Bc(n,e);si(n,d),oe(n.eventQueue_,d,[])}function xp(n){ri(n,"onDisconnectEvents");let e=Ss(n),t=Fn();Ur(n.onDisconnect_,w(),(r,s)=>{let o=Ip(r,s,n.serverSyncTree_,e);sc(t,r,o)});let i=[];Ur(t,w(),(r,s)=>{i=i.concat(Gt(n.serverSyncTree_,r,s));let o=Bc(n,r);si(n,o)}),n.onDisconnect_=Fn(),oe(n.eventQueue_,w(),i)}function Fp(n,e,t){let i;v(e._path)===".info"?i=Jr(n.infoSyncTree_,e,t):i=Jr(n.serverSyncTree_,e,t),Dc(n.eventQueue_,e._path,i)}function Aa(n,e,t){let i;v(e._path)===".info"?i=Kn(n.infoSyncTree_,e,t):i=Kn(n.serverSyncTree_,e,t),Dc(n.eventQueue_,e._path,i)}function Up(n){n.persistentConnection_&&n.persistentConnection_.interrupt(Pp)}function ri(n,...e){let t="";n.persistentConnection_&&(t=n.persistentConnection_.id+":"),D(t,...e)}function Wp(n,e,t,i){e&&ct(()=>{if(t==="ok")e(null);else{let r=(t||"error").toUpperCase(),s=r;i&&(s+=": "+i);let o=new Error(s);o.code=r,e(o)}})}function Fc(n,e,t){return gs(n.serverSyncTree_,e,t)||g.EMPTY_NODE}function ks(n,e=n.transactionQueueTree_){if(e||oi(n,e),lt(e)){let t=Wc(n,e);p(t.length>0,"Sending zero length transaction queue"),t.every(r=>r.status===0)&&Vp(n,Yt(e),t)}else Ac(e)&&ii(e,t=>{ks(n,t)})}function Vp(n,e,t){let i=t.map(l=>l.currentWriteId),r=Fc(n,e,i),s=r,o=r.hash();for(let l=0;l<t.length;l++){let h=t[l];p(h.status===0,"tryToSendTransactionQueue_: items in queue should all be run."),h.status=1,h.retryCount++;let d=M(e,h.path);s=s.updateChild(d,h.currentOutputSnapshotRaw)}let a=s.val(!0),c=e;n.server_.put(c.toString(),a,l=>{ri(n,"transaction put response",{path:c.toString(),status:l});let h=[];if(l==="ok"){let d=[];for(let u=0;u<t.length;u++)t[u].status=2,h=h.concat(Me(n.serverSyncTree_,t[u].currentWriteId)),t[u].onComplete&&d.push(()=>t[u].onComplete(null,!0,t[u].currentOutputSnapshotResolved)),t[u].unwatcher();oi(n,ws(n.transactionQueueTree_,e)),ks(n,n.transactionQueueTree_),oe(n.eventQueue_,e,h);for(let u=0;u<d.length;u++)ct(d[u])}else{if(l==="datastale")for(let d=0;d<t.length;d++)t[d].status===3?t[d].status=4:t[d].status=0;else{F("transaction at "+c.toString()+" failed: "+l);for(let d=0;d<t.length;d++)t[d].status=4,t[d].abortReason=l}si(n,e)}},o)}function si(n,e){let t=Uc(n,e),i=Yt(t),r=Wc(n,t);return Bp(n,r,i),i}function Bp(n,e,t){if(e.length===0)return;let i=[],r=[],o=e.filter(a=>a.status===0).map(a=>a.currentWriteId);for(let a=0;a<e.length;a++){let c=e[a],l=M(t,c.path),h=!1,d;if(p(l!==null,"rerunTransactionsUnderNode_: relativePath should not be null."),c.status===4)h=!0,d=c.abortReason,r=r.concat(Me(n.serverSyncTree_,c.currentWriteId,!0));else if(c.status===0)if(c.retryCount>=Np)h=!0,d="maxretry",r=r.concat(Me(n.serverSyncTree_,c.currentWriteId,!0));else{let u=Fc(n,c.path,o);c.currentInputSnapshot=u;let f=e[a].update(u.val());if(f!==void 0){Ts("transaction failed: Data returned ",f,c.path);let m=O(f);typeof f=="object"&&f!=null&&te(f,".priority")||(m=m.updatePriority(u.getPriority()));let A=c.currentWriteId,V=Ss(n),B=bc(m,u,V);c.currentOutputSnapshotRaw=m,c.currentOutputSnapshotResolved=B,c.currentWriteId=xc(n),o.splice(o.indexOf(A),1),r=r.concat(Ic(n.serverSyncTree_,c.path,B,c.currentWriteId,c.applyLocally)),r=r.concat(Me(n.serverSyncTree_,A,!0))}else h=!0,d="nodata",r=r.concat(Me(n.serverSyncTree_,c.currentWriteId,!0))}oe(n.eventQueue_,t,r),r=[],h&&(e[a].status=2,(function(u){setTimeout(u,Math.floor(0))})(e[a].unwatcher),e[a].onComplete&&(d==="nodata"?i.push(()=>e[a].onComplete(null,!1,e[a].currentInputSnapshot)):i.push(()=>e[a].onComplete(new Error(d),!1,null))))}oi(n,n.transactionQueueTree_);for(let a=0;a<i.length;a++)ct(i[a]);ks(n,n.transactionQueueTree_)}function Uc(n,e){let t,i=n.transactionQueueTree_;for(t=v(e);t!==null&&lt(i)===void 0;)i=ws(i,t),e=S(e),t=v(e);return i}function Wc(n,e){let t=[];return Vc(n,e,t),t.sort((i,r)=>i.order-r.order),t}function Vc(n,e,t){let i=lt(e);if(i)for(let r=0;r<i.length;r++)t.push(i[r]);ii(e,r=>{Vc(n,r,t)})}function oi(n,e){let t=lt(e);if(t){let i=0;for(let r=0;r<t.length;r++)t[r].status!==2&&(t[i]=t[r],i++);t.length=i,Sc(e,t.length>0?t:void 0)}ii(e,i=>{oi(n,i)})}function Bc(n,e){let t=Yt(Uc(n,e)),i=ws(n.transactionQueueTree_,e);return wp(i,r=>{hr(n,r)}),hr(n,i),kc(i,r=>{hr(n,r)}),t}function hr(n,e){let t=lt(e);if(t){let i=[],r=[],s=-1;for(let o=0;o<t.length;o++)t[o].status===3||(t[o].status===1?(p(s===o-1,"All SENT items should be at beginning of queue."),s=o,t[o].status=3,t[o].abortReason="set"):(p(t[o].status===0,"Unexpected transaction status in abort"),t[o].unwatcher(),r=r.concat(Me(n.serverSyncTree_,t[o].currentWriteId,!0)),t[o].onComplete&&i.push(t[o].onComplete.bind(null,new Error("set"),!1,null))));s===-1?Sc(e,void 0):t.length=s+1,oe(n.eventQueue_,Yt(e),r);for(let o=0;o<i.length;o++)ct(i[o])}}function Hp(n){let e="",t=n.split("/");for(let i=0;i<t.length;i++)if(t[i].length>0){let r=t[i];try{r=decodeURIComponent(r.replace(/\+/g," "))}catch{}e+="/"+r}return e}function $p(n){let e={};n.charAt(0)==="?"&&(n=n.substring(1));for(let t of n.split("&")){if(t.length===0)continue;let i=t.split("=");i.length===2?e[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):F(`Invalid query segment '${t}' in query '${n}'`)}return e}var ka=function(n,e){let t=jp(n),i=t.namespace;t.domain==="firebase.com"&&de(t.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),(!i||i==="undefined")&&t.domain!=="localhost"&&de("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),t.secure||bh();let r=t.scheme==="ws"||t.scheme==="wss";return{repoInfo:new Rn(t.host,t.secure,i,r,e,"",i!==t.subdomain),path:new b(t.pathString)}},jp=function(n){let e="",t="",i="",r="",s="",o=!0,a="https",c=443;if(typeof n=="string"){let l=n.indexOf("//");l>=0&&(a=n.substring(0,l-1),n=n.substring(l+2));let h=n.indexOf("/");h===-1&&(h=n.length);let d=n.indexOf("?");d===-1&&(d=n.length),e=n.substring(0,Math.min(h,d)),h<d&&(r=Hp(n.substring(h,d)));let u=$p(n.substring(Math.min(n.length,d)));l=e.indexOf(":"),l>=0?(o=a==="https"||a==="wss",c=parseInt(e.substring(l+1),10)):l=e.length;let f=e.slice(0,l);if(f.toLowerCase()==="localhost")t="localhost";else if(f.split(".").length<=2)t=f;else{let m=e.indexOf(".");i=e.substring(0,m).toLowerCase(),t=e.substring(m+1),s=i}"ns"in u&&(s=u.ns)}return{host:e,port:c,domain:t,subdomain:i,secure:o,scheme:a,pathString:r,namespace:s}};var Ra="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",zp=(function(){let n=0,e=[];return function(t){let i=t===n;n=t;let r,s=new Array(8);for(r=7;r>=0;r--)s[r]=Ra.charAt(t%64),t=Math.floor(t/64);p(t===0,"Cannot push at time == 0");let o=s.join("");if(i){for(r=11;r>=0&&e[r]===63;r--)e[r]=0;e[r]++}else for(r=0;r<12;r++)e[r]=Math.floor(Math.random()*64);for(r=0;r<12;r++)o+=Ra.charAt(e[r]);return p(o.length===20,"nextPushId: Length should be 20."),o}})();var Yn=class{constructor(e,t,i,r){this.eventType=e,this.eventRegistration=t,this.snapshot=i,this.prevName=r}getPath(){let e=this.snapshot.ref;return this.eventType==="value"?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+P(this.snapshot.exportVal())}},Jn=class{constructor(e,t,i){this.eventRegistration=e,this.error=t,this.path=i}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}};var Qn=class{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return p(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||this.snapshotCallback.userCallback!==void 0&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}};var ns=class n{constructor(e,t,i,r){this._repo=e,this._path=t,this._queryParams=i,this._orderByCalled=r}get key(){return I(this._path)?null:Ja(this._path)}get ref(){return new ae(this._repo,this._path)}get _queryIdentifier(){let e=fa(this._queryParams),t=as(e);return t==="{}"?"default":t}get _queryObject(){return fa(this._queryParams)}isEqual(e){if(e=x(e),!(e instanceof n))return!1;let t=this._repo===e._repo,i=ls(this._path,e._path),r=this._queryIdentifier===e._queryIdentifier;return t&&i&&r}toJSON(){return this.toString()}toString(){return this._repo.toString()+sf(this._path)}};var ae=class n extends ns{constructor(e,t){super(e,t,new Mr,!1)}get parent(){let e=Xa(this._path);return e===null?null:new n(this._repo,e)}get root(){let e=this;for(;e.parent!==null;)e=e.parent;return e}},$t=class n{constructor(e,t,i){this._node=e,this.ref=t,this._index=i}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){let t=new b(e),i=We(this.ref,e);return new n(this._node.getChild(t),i,k)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return this._node.isLeafNode()?!1:!!this._node.forEachChild(this._index,(i,r)=>e(new n(r,We(this.ref,i),k)))}hasChild(e){let t=new b(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return this._node.isLeafNode()?!1:!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}};function Hc(n,e){return n=x(n),n._checkNotDeleted("ref"),e!==void 0?We(n._root,e):n._root}function We(n,e){return n=x(n),v(n._path)===null?Ap("child","path",e,!1):Oc("child","path",e,!1),new ae(n._repo,N(n._path,e))}function $c(n,e){n=x(n),Cs("push",n._path),Nc("push",e,n._path,!0);let t=Mc(n._repo),i=zp(t),r=We(n,i),s=We(n,i),o;return e!=null?o=ai(s,e).then(()=>s):o=Promise.resolve(s),r.then=o.then.bind(o),r.catch=o.then.bind(o,void 0),r}function jc(n){return Cs("remove",n._path),ai(n,null)}function ai(n,e){n=x(n),Cs("set",n._path),Nc("set",e,n._path,!1);let t=new z;return Mp(n._repo,n._path,e,null,t.wrapCallback(()=>{})),t.promise}function zc(n){n=x(n);let e=new Qn(()=>{}),t=new Xn(e);return Lp(n._repo,n,t).then(i=>new $t(i,new ae(n._repo,n._path),n._queryParams.getIndex()))}var Xn=class n{constructor(e){this.callbackContext=e}respondsTo(e){return e==="value"}createEvent(e,t){let i=t._queryParams.getIndex();return new Yn("value",this,new $t(e.snapshotNode,new ae(t._repo,t._path),i))}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Jn(this,e,t):null}matches(e){return e instanceof n?!e.callbackContext||!this.callbackContext?!0:e.callbackContext.matches(this.callbackContext):!1}hasAnyCallback(){return this.callbackContext!==null}},is=class n{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t=e==="children_added"?"child_added":e;return t=t==="children_removed"?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Jn(this,e,t):null}createEvent(e,t){p(e.childName!=null,"Child events should have a childName.");let i=We(new ae(t._repo,t._path),e.childName),r=t._queryParams.getIndex();return new Yn(e.type,this,new $t(e.snapshotNode,i,r),e.prevName)}getEventRunner(e){return e.getEventType()==="cancel"?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof n?this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext)):!1}hasAnyCallback(){return!!this.callbackContext}};function qp(n,e,t,i,r){let s;if(typeof i=="object"&&(s=void 0,r=i),typeof i=="function"&&(s=i),r&&r.onlyOnce){let c=t,l=(h,d)=>{Aa(n._repo,n,a),c(h,d)};l.userCallback=t.userCallback,l.context=t.context,t=l}let o=new Qn(t,s||void 0),a=e==="value"?new Xn(o):new is(e,o);return Fp(n._repo,n,a),()=>Aa(n._repo,n,a)}function qc(n,e,t,i){return qp(n,"value",e,t,i)}ep(ae);sp(ae);var Gp="FIREBASE_DATABASE_EMULATOR_HOST",rs={},Kp=!1;function Yp(n,e,t,i){let r=e.lastIndexOf(":"),s=e.substring(0,r),o=we(s);n.repoInfo_=new Rn(e,o,n.repoInfo_.namespace,n.repoInfo_.webSocketOnly,n.repoInfo_.nodeAdmin,n.repoInfo_.persistenceKey,n.repoInfo_.includeNamespaceInQueryParams,!0,t),i&&(n.authTokenProvider_=i)}function Jp(n,e,t,i,r){let s=i||n.options.databaseURL;s===void 0&&(n.options.projectId||de("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),D("Using default host for project ",n.options.projectId),s=`${n.options.projectId}-default-rtdb.firebaseio.com`);let o=ka(s,r),a=o.repoInfo,c,l;typeof process<"u"&&process.env&&(l=process.env[Gp]),l?(c=!0,s=`http://${l}?ns=${a.namespace}`,o=ka(s,r),a=o.repoInfo):c=!o.repoInfo.secure;let h=r&&c?new Dt(Dt.OWNER):new vr(n.name,n.options,e);kp("Invalid Firebase Database URL",o),I(o.path)||de("Database URL must point to the root of a Firebase Database (not including a child path).");let d=Xp(a,n,h,new gr(n,t));return new ss(d,n)}function Qp(n,e){let t=rs[e];(!t||t[n.key]!==n)&&de(`Database ${e}(${n.repoInfo_}) has already been deleted.`),Up(n),delete t[n.key]}function Xp(n,e,t,i){let r=rs[e.name];r||(r={},rs[e.name]=r);let s=r[n.toURLString()];return s&&de("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),s=new ts(n,Kp,t,i),r[n.toURLString()]=s,s}var ss=class{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(Op(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new ae(this._repo,w())),this._rootInternal}_delete(){return this._rootInternal!==null&&(Qp(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){this._rootInternal===null&&de("Cannot call "+e+" on a deleted database.")}};function Gc(n=Ge(),e){let t=ln(n,"database").getImmediate({identifier:e});if(!t._instanceStarted){let i=Ks("database");i&&Kc(t,...i)}return t}function Kc(n,e,t,i={}){n=x(n),n._checkNotDeleted("useEmulator");let r=`${e}:${t}`,s=n._repoInternal;if(n._instanceStarted){if(r===n._repoInternal.repoInfo_.host&&Ce(i,s.repoInfo_.emulatorOptions))return;de("connectDatabaseEmulator() cannot initialize or alter the emulator configuration after the database instance has started.")}let o;if(s.repoInfo_.nodeAdmin)i.mockUserToken&&de('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),o=new Dt(Dt.OWNER);else if(i.mockUserToken){let a=typeof i.mockUserToken=="string"?i.mockUserToken:Js(i.mockUserToken,n.app.options.projectId);o=new Dt(a)}we(e)&&(Ti(e),Ci("Database",!0)),Yp(s,r,i,o)}function Zp(n){wh(qe),K(new L("database",(e,{instanceIdentifier:t})=>{let i=e.getProvider("app").getImmediate(),r=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return Jp(i,r,s,t)},"PUBLIC").setMultipleInstances(!0)),R(Jo,Qo,n),R(Jo,Qo,"esm2017")}us.prototype.simpleListen=function(n,e){this.sendRequest("q",{p:n},e)};us.prototype.echo=function(n,e){this.sendRequest("echo",{d:n},e)};Zp();var Jt=class{constructor(e){return e}},Yc="database",Rs=class{constructor(){return Ye(Yc)}};var Ps=new Qt("angularfire2.database-instances");function e_(n,e){let t=hn(Yc,n,e);return t&&new Jt(t)}function t_(n){return(e,t)=>{let i=e.runOutsideAngular(()=>n(t));return new Jt(i)}}var n_={provide:Rs,deps:[[new he,Ps]]},i_={provide:Jt,useFactory:e_,deps:[[new he,Ps],Re]};function Pv(n,...e){return R("angularfire",Ae.full,"rtdb"),Xt([i_,n_,{provide:Ps,useFactory:t_(n),multi:!0,deps:[fe,He,ke,It,[new he,Sn],[new he,pn],...e]}])}var Nv=H(zc,!0),Ov=H(Gc,!0);var Dv=H(qc,!0);var Lv=H($c,!0,2);var Mv=H(Hc,!0,2);var xv=H(jc,!0,2);var Fv=H(ai,!0,2);export{sm as a,om as b,Jt as c,Pv as d,Nv as e,Ov as f,Dv as g,Lv as h,Mv as i,xv as j,Fv as k};
